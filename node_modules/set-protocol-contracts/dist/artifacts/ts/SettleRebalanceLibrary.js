"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.SettleRebalanceLibrary={contractName:"SettleRebalanceLibrary",abi:[{constant:true,inputs:[{name:"_totalSupply",type:"uint256"},{name:"_naturalUnit",type:"uint256"},{name:"_nextSet",type:"address"},{name:"_vaultAddress",type:"address"}],name:"calculateNextSetIssueQuantity",outputs:[{name:"",type:"uint256"},{name:"",type:"uint256"}],payable:false,stateMutability:"view",type:"function"},{constant:true,inputs:[{name:"_vaultAddress",type:"address"},{components:[{name:"naturalUnit",type:"uint256"},{name:"components",type:"address[]"},{name:"units",type:"uint256[]"}],name:"_setToken",type:"tuple"}],name:"calculateMaxIssueAmount",outputs:[{name:"",type:"uint256"}],payable:false,stateMutability:"view",type:"function"}],metadata:'{"compiler":{"version":"0.5.7+commit.6da8b019"},"language":"Solidity","output":{"abi":[{"constant":true,"inputs":[{"name":"_totalSupply","type":"uint256"},{"name":"_naturalUnit","type":"uint256"},{"name":"_nextSet","type":"address"},{"name":"_vaultAddress","type":"address"}],"name":"calculateNextSetIssueQuantity","outputs":[{"name":"","type":"uint256"},{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"_vaultAddress","type":"address"},{"components":[{"name":"naturalUnit","type":"uint256"},{"name":"components","type":"address[]"},{"name":"units","type":"uint256[]"}],"name":"_setToken","type":"tuple"}],"name":"calculateMaxIssueAmount","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"}],"devdoc":{"author":"Set Protocol * Default implementation of Rebalancing Set Token settle rebalance and related functions.","methods":{"calculateMaxIssueAmount(address,SetTokenLibrary.SetDetails)":{"params":{"_setToken":"nextSet details","_vaultAddress":"Vault address"},"return":"uint256          maxIssueAmount"},"calculateNextSetIssueQuantity(uint256,uint256,address,address)":{"params":{"_naturalUnit":"Natural unit of rebalancing set token","_nextSet":"Address of next set","_totalSupply":"Total supply of rebalancing set token","_vaultAddress":"Vault address"},"return":"uint256             Amount of nextSets to issueuint256             New unitShares for the rebalancingSetToken"},"settleRebalance(uint256,uint256,uint256,uint256,address,address,address,uint8)":{"params":{"_coreAddress":"Core address","_minimumBid":"Minimum bid allowed, used to see if valid settle","_naturalUnit":"Natural unit of rebalancing set token","_nextSet":"Address of next set","_remainingCurrentSets":"Amount of currentSets remaining","_totalSupply":"Total supply of rebalancing set token","_vaultAddress":"Vault address"},"return":"uint256                 Amount of nextSets to issue"}},"title":"SettleRebalanceLibrary"},"userdoc":{"methods":{"calculateMaxIssueAmount(address,SetTokenLibrary.SetDetails)":{"notice":"Get the maximum possible issue amount of nextSet based on number of components owned by rebalancing set token."},"calculateNextSetIssueQuantity(uint256,uint256,address,address)":{"notice":"Calculate the amount of nextSets to issue by using the component amounts in the vault, unitShares following from this calculation."},"settleRebalance(uint256,uint256,uint256,uint256,address,address,address,uint8)":{"notice":"Calculate the amount of nextSets to issue by using the component amounts in the vault, new unitShares follow from this calculation"}}}},"settings":{"compilationTarget":{"/Users/justin_chen/Dropbox/workspace/set-protocol-contracts/contracts/core/tokens/rebalancing-libraries/SettleRebalanceLibrary.sol":"SettleRebalanceLibrary"},"evmVersion":"byzantium","libraries":{},"optimizer":{"enabled":true,"runs":200},"remappings":[]},"sources":{"/Users/justin_chen/Dropbox/workspace/set-protocol-contracts/contracts/core/interfaces/ICore.sol":{"keccak256":"0x5dc3db4398630ea52d2a40c9ddfa89d94e65c2770a12bab4d2a5c8eb573fb0a0","urls":["bzzr://25e90b53f61b388e0950b808e2296f82d427b66cfd6021212713436b2a592e31"]},"/Users/justin_chen/Dropbox/workspace/set-protocol-contracts/contracts/core/interfaces/ISetToken.sol":{"keccak256":"0xfa6c0c07f8394d89b6b8f72e15778f8452a9341acb20cebb8421f3522aaca1bd","urls":["bzzr://ccf23bb78fd507bf8cbf5cf7ac2a660a1463b87a3689196e42b8f6862d1a6b11"]},"/Users/justin_chen/Dropbox/workspace/set-protocol-contracts/contracts/core/interfaces/IVault.sol":{"keccak256":"0xf8a6d376173be39f5744492866db5dd3f91453a124d23679ff164ff3817f2f4f","urls":["bzzr://896c0a8329175c1620e1a22467778b835defe0e61847e5a8427a306f42391e64"]},"/Users/justin_chen/Dropbox/workspace/set-protocol-contracts/contracts/core/lib/RebalancingLibrary.sol":{"keccak256":"0x7f9dd2f95b2ee71a98b94cb9b0df15874aa134e7480d04a1fcf36aff166a55f4","urls":["bzzr://f43a5563ec5df095151eee30cf7a0941b5a971917c27c7b34d9586b36563ab5b"]},"/Users/justin_chen/Dropbox/workspace/set-protocol-contracts/contracts/core/lib/SetTokenLibrary.sol":{"keccak256":"0x0c0952057a64c3af0ace01db29258145deff7d935bdc53d1bbab6fff87b3b146","urls":["bzzr://ad1944f45fade934870661a4e91c260625755760ff0ef047677547fbdc6a16bf"]},"/Users/justin_chen/Dropbox/workspace/set-protocol-contracts/contracts/core/tokens/rebalancing-libraries/SettleRebalanceLibrary.sol":{"keccak256":"0x19037f72af24be5869f238d095542d466345f15fc11d8997697b83ad9b897dac","urls":["bzzr://b2913da0eee2e415a450c5805646e80b9eb19ef7186b3b5e9ec9ed627d17fe33"]},"/Users/justin_chen/Dropbox/workspace/set-protocol-contracts/contracts/lib/CommonMath.sol":{"keccak256":"0x3d1d08c6efc2a973fe2c02ddcb02fd99a8c8eb75f74dcbd93e8e15864eee2b6b","urls":["bzzr://580815dd1cf648a4521d923e59087de21143d9c48115ab71579a1f5a8f3d36af"]},"openzeppelin-solidity/contracts/math/Math.sol":{"keccak256":"0x775160984ceb0931bf67e718fb23afd6fc2a5d38a6e2378ebb438a039ed2269e","urls":["bzzr://209e27ad1c13e3e9b157915e0269ee4c3b6f0a494660dcc4acf1faf102e1a7ad"]},"openzeppelin-solidity/contracts/math/SafeMath.sol":{"keccak256":"0xc2a200a877c4a9b2475c246c54ffecc69ffde3e11af83319c63c2dc5458bac80","urls":["bzzr://c8876e2c39b60f155d748d71d715c8f3903fae5a405ac599adcb6ad2f9a583f9"]}},"version":1}',bytecode:"0x610d3c610026600b82828239805160001a60731461001957fe5b30600052607381538281f3fe730000000000000000000000000000000000000000301460806040526004361061004e5760e060020a6000350463084f9bce8114610053578063495c23bd14610089578063ec85e975146100aa575b600080fd5b81801561005f57600080fd5b5061007361006e3660046109d7565b6100bd565b6040516100809190610c6e565b60405180910390f35b61009c610097366004610976565b61021e565b604051610080929190610c7c565b6100736100b8366004610894565b6102a2565b600060ff8216600214610105576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016100fc90610c5e565b60405180910390fd5b86881061013e576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016100fc90610c3e565b60008061014d8b89898861021e565b909250905080610189576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016100fc90610c4e565b6040517fa57de4cf00000000000000000000000000000000000000000000000000000000815273ffffffffffffffffffffffffffffffffffffffff87169063a57de4cf906101dd908a908690600401610c23565b600060405180830381600087803b1580156101f757600080fd5b505af115801561020b573d6000803e3d6000fd5b50929d9c50505050505050505050505050565b6000806102296105dd565b610232856103c1565b9050600061024085836102a2565b90506000610254898963ffffffff61058716565b835190915060009061027c90610270858263ffffffff61058716565b9063ffffffff6105a916565b90506000610290828463ffffffff61058716565b919b919a509098505050505050505050565b6000806102ad6105d7565b90508360005b8460200151518110156103b55760008273ffffffffffffffffffffffffffffffffffffffff16631f98ade3876020015184815181106102ee57fe5b6020026020010151306040518363ffffffff1660e060020a028152600401610317929190610c08565b60206040518083038186803b15801561032f57600080fd5b505afa158015610343573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052506103679190810190610958565b9050600061039d87600001516102708960400151868151811061038657fe5b60200260200101518561058790919063ffffffff16565b9050848110156103ab578094505b50506001016102b3565b50909150505b92915050565b6103c96105dd565b600082905060008173ffffffffffffffffffffffffffffffffffffffff166342a7cfd56040518163ffffffff1660e060020a02815260040160206040518083038186803b15801561041957600080fd5b505afa15801561042d573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052506104519190810190610958565b905060608273ffffffffffffffffffffffffffffffffffffffff166399d50d5d6040518163ffffffff1660e060020a02815260040160006040518083038186803b15801561049e57600080fd5b505afa1580156104b2573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f191682016040526104da91908101906108e6565b905060608373ffffffffffffffffffffffffffffffffffffffff1663027aa9f56040518163ffffffff1660e060020a02815260040160006040518083038186803b15801561052757600080fd5b505afa15801561053b573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f191682016040526105639190810190610923565b60408051606081018252948552602085019390935291830191909152509392505050565b600080821161059557600080fd5b60008284816105a057fe5b04949350505050565b6000826105b8575060006103bb565b828202828482816105c557fe5b04146105d057600080fd5b9392505050565b60001990565b60405180606001604052806000815260200160608152602001606081525090565b60006105d08235610cdb565b60006105d08251610cdb565b600082601f83011261062757600080fd5b813561063a61063582610cb1565b610c8a565b9150818183526020840193506020810190508385602084028201111561065f57600080fd5b60005b8381101561068b578161067588826105fe565b8452506020928301929190910190600101610662565b5050505092915050565b600082601f8301126106a657600080fd5b81516106b461063582610cb1565b915081818352602084019350602081019050838560208402820111156106d957600080fd5b60005b8381101561068b57816106ef888261060a565b84525060209283019291909101906001016106dc565b600082601f83011261071657600080fd5b813561072461063582610cb1565b9150818183526020840193506020810190508385602084028201111561074957600080fd5b60005b8381101561068b578161075f8882610870565b845250602092830192919091019060010161074c565b600082601f83011261078657600080fd5b815161079461063582610cb1565b915081818352602084019350602081019050838560208402820111156107b957600080fd5b60005b8381101561068b57816107cf888261087c565b84525060209283019291909101906001016107bc565b6000606082840312156107f757600080fd5b6108016060610c8a565b9050600061080f8484610870565b825250602082013567ffffffffffffffff81111561082c57600080fd5b61083884828501610616565b602083015250604082013567ffffffffffffffff81111561085857600080fd5b61086484828501610705565b60408301525092915050565b60006105d08235610cf9565b60006105d08251610cf9565b60006105d08235610cfc565b600080604083850312156108a757600080fd5b60006108b385856105fe565b925050602083013567ffffffffffffffff8111156108d057600080fd5b6108dc858286016107e5565b9150509250929050565b6000602082840312156108f857600080fd5b815167ffffffffffffffff81111561090f57600080fd5b61091b84828501610695565b949350505050565b60006020828403121561093557600080fd5b815167ffffffffffffffff81111561094c57600080fd5b61091b84828501610775565b60006020828403121561096a57600080fd5b600061091b848461087c565b6000806000806080858703121561098c57600080fd5b60006109988787610870565b94505060206109a987828801610870565b93505060406109ba878288016105fe565b92505060606109cb878288016105fe565b91505092959194509250565b600080600080600080600080610100898b0312156109f457600080fd5b6000610a008b8b610870565b9850506020610a118b828c01610870565b9750506040610a228b828c01610870565b9650506060610a338b828c01610870565b9550506080610a448b828c016105fe565b94505060a0610a558b828c016105fe565b93505060c0610a668b828c016105fe565b92505060e0610a778b828c01610888565b9150509295985092959890939650565b610a9081610cdb565b82525050565b6000610aa3603c83610cd2565b7f526562616c616e63696e67536574546f6b656e2e736574746c65526562616c6181527f6e63653a20526562616c616e6365206e6f7420636f6d706c6574656400000000602082015260400192915050565b6000610b02606283610cd2565b7f526562616c616e63696e67536574546f6b656e2e736574746c65526562616c6181527f6e63653a204661696c656420726562616c616e63652c20756e6974736861726560208201527f7320657175616c7320302e2043616c6c20656e644661696c656441756374696f60408201527f6e2e000000000000000000000000000000000000000000000000000000000000606082015260800192915050565b6000610bad603c83610cd2565b7f526562616c616e63696e67536574546f6b656e2e736574746c65526562616c6181527f6e63653a205374617465206d75737420626520526562616c616e636500000000602082015260400192915050565b610a9081610cf9565b60408101610c168285610a87565b6105d06020830184610a87565b60408101610c318285610a87565b6105d06020830184610bff565b602080825281016103bb81610a96565b602080825281016103bb81610af5565b602080825281016103bb81610ba0565b602081016103bb8284610bff565b60408101610c318285610bff565b60405181810167ffffffffffffffff81118282101715610ca957600080fd5b604052919050565b600067ffffffffffffffff821115610cc857600080fd5b5060209081020190565b90815260200190565b600073ffffffffffffffffffffffffffffffffffffffff82166103bb565b90565b60ff169056fea265627a7a7230582055d769a5621b93d7883a400c22714730e861cc5df702f5cc0cca543193c137296c6578706572696d656e74616cf50037",deployedBytecode:"0x730000000000000000000000000000000000000000301460806040526004361061004e5760e060020a6000350463084f9bce8114610053578063495c23bd14610089578063ec85e975146100aa575b600080fd5b81801561005f57600080fd5b5061007361006e3660046109d7565b6100bd565b6040516100809190610c6e565b60405180910390f35b61009c610097366004610976565b61021e565b604051610080929190610c7c565b6100736100b8366004610894565b6102a2565b600060ff8216600214610105576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016100fc90610c5e565b60405180910390fd5b86881061013e576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016100fc90610c3e565b60008061014d8b89898861021e565b909250905080610189576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016100fc90610c4e565b6040517fa57de4cf00000000000000000000000000000000000000000000000000000000815273ffffffffffffffffffffffffffffffffffffffff87169063a57de4cf906101dd908a908690600401610c23565b600060405180830381600087803b1580156101f757600080fd5b505af115801561020b573d6000803e3d6000fd5b50929d9c50505050505050505050505050565b6000806102296105dd565b610232856103c1565b9050600061024085836102a2565b90506000610254898963ffffffff61058716565b835190915060009061027c90610270858263ffffffff61058716565b9063ffffffff6105a916565b90506000610290828463ffffffff61058716565b919b919a509098505050505050505050565b6000806102ad6105d7565b90508360005b8460200151518110156103b55760008273ffffffffffffffffffffffffffffffffffffffff16631f98ade3876020015184815181106102ee57fe5b6020026020010151306040518363ffffffff1660e060020a028152600401610317929190610c08565b60206040518083038186803b15801561032f57600080fd5b505afa158015610343573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052506103679190810190610958565b9050600061039d87600001516102708960400151868151811061038657fe5b60200260200101518561058790919063ffffffff16565b9050848110156103ab578094505b50506001016102b3565b50909150505b92915050565b6103c96105dd565b600082905060008173ffffffffffffffffffffffffffffffffffffffff166342a7cfd56040518163ffffffff1660e060020a02815260040160206040518083038186803b15801561041957600080fd5b505afa15801561042d573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052506104519190810190610958565b905060608273ffffffffffffffffffffffffffffffffffffffff166399d50d5d6040518163ffffffff1660e060020a02815260040160006040518083038186803b15801561049e57600080fd5b505afa1580156104b2573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f191682016040526104da91908101906108e6565b905060608373ffffffffffffffffffffffffffffffffffffffff1663027aa9f56040518163ffffffff1660e060020a02815260040160006040518083038186803b15801561052757600080fd5b505afa15801561053b573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f191682016040526105639190810190610923565b60408051606081018252948552602085019390935291830191909152509392505050565b600080821161059557600080fd5b60008284816105a057fe5b04949350505050565b6000826105b8575060006103bb565b828202828482816105c557fe5b04146105d057600080fd5b9392505050565b60001990565b60405180606001604052806000815260200160608152602001606081525090565b60006105d08235610cdb565b60006105d08251610cdb565b600082601f83011261062757600080fd5b813561063a61063582610cb1565b610c8a565b9150818183526020840193506020810190508385602084028201111561065f57600080fd5b60005b8381101561068b578161067588826105fe565b8452506020928301929190910190600101610662565b5050505092915050565b600082601f8301126106a657600080fd5b81516106b461063582610cb1565b915081818352602084019350602081019050838560208402820111156106d957600080fd5b60005b8381101561068b57816106ef888261060a565b84525060209283019291909101906001016106dc565b600082601f83011261071657600080fd5b813561072461063582610cb1565b9150818183526020840193506020810190508385602084028201111561074957600080fd5b60005b8381101561068b578161075f8882610870565b845250602092830192919091019060010161074c565b600082601f83011261078657600080fd5b815161079461063582610cb1565b915081818352602084019350602081019050838560208402820111156107b957600080fd5b60005b8381101561068b57816107cf888261087c565b84525060209283019291909101906001016107bc565b6000606082840312156107f757600080fd5b6108016060610c8a565b9050600061080f8484610870565b825250602082013567ffffffffffffffff81111561082c57600080fd5b61083884828501610616565b602083015250604082013567ffffffffffffffff81111561085857600080fd5b61086484828501610705565b60408301525092915050565b60006105d08235610cf9565b60006105d08251610cf9565b60006105d08235610cfc565b600080604083850312156108a757600080fd5b60006108b385856105fe565b925050602083013567ffffffffffffffff8111156108d057600080fd5b6108dc858286016107e5565b9150509250929050565b6000602082840312156108f857600080fd5b815167ffffffffffffffff81111561090f57600080fd5b61091b84828501610695565b949350505050565b60006020828403121561093557600080fd5b815167ffffffffffffffff81111561094c57600080fd5b61091b84828501610775565b60006020828403121561096a57600080fd5b600061091b848461087c565b6000806000806080858703121561098c57600080fd5b60006109988787610870565b94505060206109a987828801610870565b93505060406109ba878288016105fe565b92505060606109cb878288016105fe565b91505092959194509250565b600080600080600080600080610100898b0312156109f457600080fd5b6000610a008b8b610870565b9850506020610a118b828c01610870565b9750506040610a228b828c01610870565b9650506060610a338b828c01610870565b9550506080610a448b828c016105fe565b94505060a0610a558b828c016105fe565b93505060c0610a668b828c016105fe565b92505060e0610a778b828c01610888565b9150509295985092959890939650565b610a9081610cdb565b82525050565b6000610aa3603c83610cd2565b7f526562616c616e63696e67536574546f6b656e2e736574746c65526562616c6181527f6e63653a20526562616c616e6365206e6f7420636f6d706c6574656400000000602082015260400192915050565b6000610b02606283610cd2565b7f526562616c616e63696e67536574546f6b656e2e736574746c65526562616c6181527f6e63653a204661696c656420726562616c616e63652c20756e6974736861726560208201527f7320657175616c7320302e2043616c6c20656e644661696c656441756374696f60408201527f6e2e000000000000000000000000000000000000000000000000000000000000606082015260800192915050565b6000610bad603c83610cd2565b7f526562616c616e63696e67536574546f6b656e2e736574746c65526562616c6181527f6e63653a205374617465206d75737420626520526562616c616e636500000000602082015260400192915050565b610a9081610cf9565b60408101610c168285610a87565b6105d06020830184610a87565b60408101610c318285610a87565b6105d06020830184610bff565b602080825281016103bb81610a96565b602080825281016103bb81610af5565b602080825281016103bb81610ba0565b602081016103bb8284610bff565b60408101610c318285610bff565b60405181810167ffffffffffffffff81118282101715610ca957600080fd5b604052919050565b600067ffffffffffffffff821115610cc857600080fd5b5060209081020190565b90815260200190565b600073ffffffffffffffffffffffffffffffffffffffff82166103bb565b90565b60ff169056fea265627a7a7230582055d769a5621b93d7883a400c22714730e861cc5df702f5cc0cca543193c137296c6578706572696d656e74616cf50037",sourceMap:"1327:5493:78:-;;132:2:-1;166:7;155:9;146:7;137:37;255:7;249:14;246:1;241:23;235:4;232:33;222:2;;269:9;222:2;293:9;290:1;283:20;323:4;314:7;306:22;347:7;338;331:24",deployedSourceMap:"1327:5493:78:-;;;;;;;;;;;-1:-1:-1;;;1327:5493:78;;;;;;;;;;;;;;;;;;;;;;2172:1447;;8:9:-1;5:2;;;30:1;27;20:12;5:2;-1:-1;2172:1447:78;;;;;;;;:::i;:::-;;;;;;;;;;;;;;;;4190:1281;;;;;;;;;:::i;:::-;;;;;;;;;5766:1052;;;;;;;;;:::i;2172:1447::-;2481:7;2582:60;;;2607:34;2582:60;2561:167;;;;;;;;;;;;;;;;;;;;;;2842:11;2818:21;:35;2797:142;;;;;;;;;;;;;;2991:19;3020:22;3118:140;3161:12;3187;3213:8;3235:13;3118:29;:140::i;:::-;3052:206;;-1:-1:-1;3052:206:78;-1:-1:-1;3290:18:78;3269:163;;;;;;;;;;;;;;3491:89;;;;;:32;;;;;;:89;;3537:8;;3559:11;;3491:89;;;;;;;;;;;;;;;;;8:9:-1;5:2;;;30:1;27;20:12;5:2;3491:89:78;;;;8:9:-1;5:2;;;45:16;42:1;39;24:38;77:16;74:1;67:27;5:2;-1:-1;3598:14:78;;2172:1447;-1:-1:-1;;;;;;;;;;;;;2172:1447:78:o;4190:1281::-;4397:7;4406;4487:46;;:::i;:::-;4536:39;4566:8;4536:29;:39::i;:::-;4487:88;;4585:22;4610:86;4647:13;4674:12;4610:23;:86::i;:::-;4585:111;-1:-1:-1;4796:31:78;4830:30;:12;4847;4830:30;:16;:30;:::i;:::-;5235:24;;4796:64;;-1:-1:-1;5164:19:78;;5186:74;;:44;:14;5235:24;5186:44;:18;:44;:::i;:::-;:48;:74;:48;:74;:::i;:::-;5164:96;-1:-1:-1;5355:21:78;5379:40;5164:96;5395:23;5379:40;:15;:40;:::i;:::-;5437:11;;;;-1:-1:-1;4190:1281:78;;-1:-1:-1;;;;;;;;;4190:1281:78:o;5766:1052::-;5934:7;5957:22;5982:23;:21;:23::i;:::-;5957:48;-1:-1:-1;6045:13:78;6015:20;6070:710;6094:9;:20;;;:27;6090:1;:31;6070:710;;;6220:23;6246:13;:29;;;6293:9;:20;;;6314:1;6293:23;;;;;;;;;;;;;;6342:4;6246:115;;;;;-1:-1:-1;;;6246:115:78;;;;;;;;;;;;;;;;;;;;;;;8:9:-1;5:2;;;30:1;27;20:12;5:2;6246:115:78;;;;8:9:-1;5:2;;;45:16;42:1;39;24:38;77:16;74:1;67:27;5:2;6246:115:78;;;;;;;101:4:-1;97:9;90:4;84;80:15;76:31;69:5;65:43;126:6;120:4;113:20;0:138;6246:115:78;;;;;;;;;6220:141;;6546:28;6577:66;6621:9;:21;;;6577:39;6597:9;:15;;;6613:1;6597:18;;;;;;;;;;;;;;6577:15;:19;;:39;;;;:::i;:66::-;6546:97;;6684:14;6661:20;:37;6657:113;;;6735:20;6718:37;;6657:113;-1:-1:-1;;6123:3:78;;6070:710;;;-1:-1:-1;6797:14:78;;-1:-1:-1;;5766:1052:78;;;;;:::o;2980:564:45:-;3078:17;;:::i;:::-;3150:18;3181:4;3150:36;;3235:19;3257:8;:20;;;:22;;;;;-1:-1:-1;;;3257:22:45;;;;;;;;;;;;;;;;8:9:-1;5:2;;;30:1;27;20:12;5:2;3257:22:45;;;;8:9:-1;5:2;;;45:16;42:1;39;24:38;77:16;74:1;67:27;5:2;3257:22:45;;;;;;;101:4:-1;97:9;90:4;84;80:15;76:31;69:5;65:43;126:6;120:4;113:20;0:138;3257:22:45;;;;;;;;;3235:44;;3289:27;3319:8;:22;;;:24;;;;;-1:-1:-1;;;3319:24:45;;;;;;;;;;;;;;;;8:9:-1;5:2;;;30:1;27;20:12;5:2;3319:24:45;;;;8:9:-1;5:2;;;45:16;42:1;39;24:38;77:16;74:1;67:27;5:2;3319:24:45;;;;;;39:16:-1;36:1;17:17;2:54;101:4;3319:24:45;80:15:-1;;;-1:-1;;76:31;65:43;;120:4;113:20;3319:24:45;;;;;;;;;3289:54;;3353:22;3378:8;:17;;;:19;;;;;-1:-1:-1;;;3378:19:45;;;;;;;;;;;;;;;;8:9:-1;5:2;;;30:1;27;20:12;5:2;3378:19:45;;;;8:9:-1;5:2;;;45:16;42:1;39;24:38;77:16;74:1;67:27;5:2;3378:19:45;;;;;;39:16:-1;36:1;17:17;2:54;101:4;3378:19:45;80:15:-1;;;-1:-1;;76:31;65:43;;120:4;113:20;3378:19:45;;;;;;;;;3415:122;;;;;;;;;;;;;;;;;;;;;;;;;-1:-1:-1;3415:122:45;2980:564;-1:-1:-1;;;2980:564:45:o;782:296:174:-;840:7;937:1;933;:5;925:14;;;;;;949:9;965:1;961;:5;;;;;;;782:296;-1:-1:-1;;;;782:296:174:o;231:421::-;289:7;529:6;525:45;;-1:-1:-1;558:1:174;551:8;;525:45;592:5;;;596:1;592;:5;:1;615:5;;;;;:10;607:19;;;;;;644:1;231:421;-1:-1:-1;;;231:421:174:o;1220:118:115:-;-1:-1:-1;;1220:118:115;:::o;1327:5493:78:-;;;;;;;;;;;;;;;;;;;;;;;;:::o;5:118:-1:-;;72:46;110:6;97:20;72:46;;130:122;;208:39;239:6;233:13;208:39;;277:699;;390:3;383:4;375:6;371:17;367:27;357:2;;408:1;405;398:12;357:2;445:6;432:20;467:76;482:60;535:6;482:60;;;467:76;;;458:85;;560:5;585:6;578:5;571:21;615:4;607:6;603:17;593:27;;637:4;632:3;628:14;621:21;;690:6;737:3;729:4;721:6;717:17;712:3;708:27;705:36;702:2;;;754:1;751;744:12;702:2;779:1;764:206;789:6;786:1;783:13;764:206;;;847:3;869:37;902:3;890:10;869:37;;;857:50;;-1:-1;930:4;921:14;;;;949;;;;;811:1;804:9;764:206;;;768:14;350:626;;;;;;;;1002:722;;1130:3;1123:4;1115:6;1111:17;1107:27;1097:2;;1148:1;1145;1138:12;1097:2;1178:6;1172:13;1200:80;1215:64;1272:6;1215:64;;1200:80;1191:89;;1297:5;1322:6;1315:5;1308:21;1352:4;1344:6;1340:17;1330:27;;1374:4;1369:3;1365:14;1358:21;;1427:6;1474:3;1466:4;1458:6;1454:17;1449:3;1445:27;1442:36;1439:2;;;1491:1;1488;1481:12;1439:2;1516:1;1501:217;1526:6;1523:1;1520:13;1501:217;;;1584:3;1606:48;1650:3;1638:10;1606:48;;;1594:61;;-1:-1;1678:4;1669:14;;;;1697;;;;;1548:1;1541:9;1501:217;;1750:699;;1863:3;1856:4;1848:6;1844:17;1840:27;1830:2;;1881:1;1878;1871:12;1830:2;1918:6;1905:20;1940:76;1955:60;2008:6;1955:60;;1940:76;1931:85;;2033:5;2058:6;2051:5;2044:21;2088:4;2080:6;2076:17;2066:27;;2110:4;2105:3;2101:14;2094:21;;2163:6;2210:3;2202:4;2194:6;2190:17;2185:3;2181:27;2178:36;2175:2;;;2227:1;2224;2217:12;2175:2;2252:1;2237:206;2262:6;2259:1;2256:13;2237:206;;;2320:3;2342:37;2375:3;2363:10;2342:37;;;2330:50;;-1:-1;2403:4;2394:14;;;;2422;;;;;2284:1;2277:9;2237:206;;2475:722;;2603:3;2596:4;2588:6;2584:17;2580:27;2570:2;;2621:1;2618;2611:12;2570:2;2651:6;2645:13;2673:80;2688:64;2745:6;2688:64;;2673:80;2664:89;;2770:5;2795:6;2788:5;2781:21;2825:4;2817:6;2813:17;2803:27;;2847:4;2842:3;2838:14;2831:21;;2900:6;2947:3;2939:4;2931:6;2927:17;2922:3;2918:27;2915:36;2912:2;;;2964:1;2961;2954:12;2912:2;2989:1;2974:217;2999:6;2996:1;2993:13;2974:217;;;3057:3;3079:48;3123:3;3111:10;3079:48;;;3067:61;;-1:-1;3151:4;3142:14;;;;3170;;;;;3021:1;3014:9;2974:217;;3245:841;;3362:4;3350:9;3345:3;3341:19;3337:30;3334:2;;;3380:1;3377;3370:12;3334:2;3398:20;3413:4;3398:20;;;3389:29;-1:-1;3475:1;3506:49;3551:3;3531:9;3506:49;;;3482:74;;-1:-1;3651:2;3636:18;;3623:32;3675:18;3664:30;;3661:2;;;3707:1;3704;3697:12;3661:2;3742:70;3808:3;3799:6;3788:9;3784:22;3742:70;;;3735:4;3728:5;3724:16;3717:96;3577:247;3903:2;3892:9;3888:18;3875:32;3927:18;3919:6;3916:30;3913:2;;;3959:1;3956;3949:12;3913:2;3994:70;4060:3;4051:6;4040:9;4036:22;3994:70;;;3987:4;3980:5;3976:16;3969:96;3834:242;3328:758;;;;;4093:118;;4160:46;4198:6;4185:20;4160:46;;4218:122;;4296:39;4327:6;4321:13;4296:39;;4347:114;;4412:44;4448:6;4435:20;4412:44;;4468:508;;;4617:2;4605:9;4596:7;4592:23;4588:32;4585:2;;;4633:1;4630;4623:12;4585:2;4668:1;4685:53;4730:7;4710:9;4685:53;;;4675:63;;4647:97;4803:2;4792:9;4788:18;4775:32;4827:18;4819:6;4816:30;4813:2;;;4859:1;4856;4849:12;4813:2;4879:81;4952:7;4943:6;4932:9;4928:22;4879:81;;;4869:91;;4754:212;4579:397;;;;;;4983:392;;5123:2;5111:9;5102:7;5098:23;5094:32;5091:2;;;5139:1;5136;5129:12;5091:2;5174:24;;5218:18;5207:30;;5204:2;;;5250:1;5247;5240:12;5204:2;5270:89;5351:7;5342:6;5331:9;5327:22;5270:89;;;5260:99;5085:290;-1:-1;;;;5085:290;5382:392;;5522:2;5510:9;5501:7;5497:23;5493:32;5490:2;;;5538:1;5535;5528:12;5490:2;5573:24;;5617:18;5606:30;;5603:2;;;5649:1;5646;5639:12;5603:2;5669:89;5750:7;5741:6;5730:9;5726:22;5669:89;;5781:263;;5896:2;5884:9;5875:7;5871:23;5867:32;5864:2;;;5912:1;5909;5902:12;5864:2;5947:1;5964:64;6020:7;6000:9;5964:64;;6051:617;;;;;6206:3;6194:9;6185:7;6181:23;6177:33;6174:2;;;6223:1;6220;6213:12;6174:2;6258:1;6275:53;6320:7;6300:9;6275:53;;;6265:63;;6237:97;6365:2;6383:53;6428:7;6419:6;6408:9;6404:22;6383:53;;;6373:63;;6344:98;6473:2;6491:53;6536:7;6527:6;6516:9;6512:22;6491:53;;;6481:63;;6452:98;6581:2;6599:53;6644:7;6635:6;6624:9;6620:22;6599:53;;;6589:63;;6560:98;6168:500;;;;;;;;6675:1117;;;;;;;;;6896:3;6884:9;6875:7;6871:23;6867:33;6864:2;;;6913:1;6910;6903:12;6864:2;6948:1;6965:53;7010:7;6990:9;6965:53;;;6955:63;;6927:97;7055:2;7073:53;7118:7;7109:6;7098:9;7094:22;7073:53;;;7063:63;;7034:98;7163:2;7181:53;7226:7;7217:6;7206:9;7202:22;7181:53;;;7171:63;;7142:98;7271:2;7289:53;7334:7;7325:6;7314:9;7310:22;7289:53;;;7279:63;;7250:98;7379:3;7398:53;7443:7;7434:6;7423:9;7419:22;7398:53;;;7388:63;;7358:99;7488:3;7507:53;7552:7;7543:6;7532:9;7528:22;7507:53;;;7497:63;;7467:99;7597:3;7616:53;7661:7;7652:6;7641:9;7637:22;7616:53;;;7606:63;;7576:99;7706:3;7725:51;7768:7;7759:6;7748:9;7744:22;7725:51;;;7715:61;;7685:97;6858:934;;;;;;;;;;;;7799:120;7882:31;7907:5;7882:31;;;7877:3;7870:44;7864:55;;;7927:465;;8087:67;8151:2;8146:3;8087:67;;;8187:66;8167:87;;8288:66;8283:2;8274:12;;8267:88;8383:2;8374:12;;8073:319;-1:-1;;8073:319;8401:668;;8561:67;8625:2;8620:3;8561:67;;;8661:66;8641:87;;8762:66;8757:2;8748:12;;8741:88;8863:66;8858:2;8849:12;;8842:88;8964:66;8959:2;8950:12;;8943:88;9059:3;9050:13;;8547:522;-1:-1;;8547:522;9078:465;;9238:67;9302:2;9297:3;9238:67;;;9338:66;9318:87;;9439:66;9434:2;9425:12;;9418:88;9534:2;9525:12;;9224:319;-1:-1;;9224:319;9551:120;9634:31;9659:5;9634:31;;9813:324;9959:2;9944:18;;9973:71;9948:9;10017:6;9973:71;;;10055:72;10123:2;10112:9;10108:18;10099:6;10055:72;;10144:324;10290:2;10275:18;;10304:71;10279:9;10348:6;10304:71;;;10386:72;10454:2;10443:9;10439:18;10430:6;10386:72;;10475:407;10666:2;10680:47;;;10651:18;;10741:131;10651:18;10741:131;;10889:407;11080:2;11094:47;;;11065:18;;11155:131;11065:18;11155:131;;11303:407;11494:2;11508:47;;;11479:18;;11569:131;11479:18;11569:131;;11717:229;11843:2;11828:18;;11857:79;11832:9;11909:6;11857:79;;11953:348;12107:2;12092:18;;12121:79;12096:9;12173:6;12121:79;;12308:256;12370:2;12364:9;12396:17;;;12471:18;12456:34;;12492:22;;;12453:62;12450:2;;;12528:1;12525;12518:12;12450:2;12544;12537:22;12348:216;;-1:-1;12348:216;12571:254;;12726:18;12718:6;12715:30;12712:2;;;12758:1;12755;12748:12;12712:2;-1:-1;12787:4;12775:17;;;12805:15;;12649:176;13624:163;13727:19;;;13776:4;13767:14;;13720:67;13795:105;;13987:42;13976:54;;13864:31;13959:76;14042:79;14111:5;14094:27;14461:88;14539:4;14528:16;;14511:38",source:'/*\n    Copyright 2018 Set Labs Inc.\n\n    Licensed under the Apache License, Version 2.0 (the "License");\n    you may not use this file except in compliance with the License.\n    You may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\n    Unless required by applicable law or agreed to in writing, software\n    distributed under the License is distributed on an "AS IS" BASIS,\n    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n    See the License for the specific language governing permissions and\n    limitations under the License.\n*/\n\npragma solidity 0.5.7;\npragma experimental "ABIEncoderV2";\n\nimport { Math } from "openzeppelin-solidity/contracts/math/Math.sol";\nimport { SafeMath } from "openzeppelin-solidity/contracts/math/SafeMath.sol";\n\nimport { CommonMath } from "../../../lib/CommonMath.sol";\nimport { ICore } from "../../interfaces/ICore.sol";\nimport { IVault } from "../../interfaces/IVault.sol";\nimport { ISetToken } from "../../interfaces/ISetToken.sol";\nimport { RebalancingLibrary } from "../../lib/RebalancingLibrary.sol";\nimport { SetTokenLibrary } from "../../lib/SetTokenLibrary.sol";\n\n\n/**\n * @title SettleRebalanceLibrary\n * @author Set Protocol\n *\n * Default implementation of Rebalancing Set Token settle rebalance and related functions.\n */\nlibrary SettleRebalanceLibrary {\n    using SafeMath for uint256;\n    /* ============ Internal Functions ============ */\n\n    /**\n     * Calculate the amount of nextSets to issue by using the component amounts in the\n     * vault, new unitShares follow from this calculation\n     *\n     * @param   _totalSupply            Total supply of rebalancing set token\n     * @param   _remainingCurrentSets   Amount of currentSets remaining\n     * @param   _minimumBid             Minimum bid allowed, used to see if valid settle\n     * @param   _naturalUnit            Natural unit of rebalancing set token\n     * @param   _nextSet                Address of next set\n     * @param   _coreAddress            Core address\n     * @param   _vaultAddress           Vault address\n     * @return  uint256                 Amount of nextSets to issue\n     */\n    function settleRebalance(\n        uint256 _totalSupply,\n        uint256 _remainingCurrentSets,\n        uint256 _minimumBid,\n        uint256 _naturalUnit,\n        address _nextSet,\n        address _coreAddress,\n        address _vaultAddress,\n        uint8 _rebalanceState\n    )\n        public\n        returns (uint256)\n    {\n        // Must be in Rebalance state to call settlement\n        require(\n            _rebalanceState == uint8(RebalancingLibrary.State.Rebalance),\n            "RebalancingSetToken.settleRebalance: State must be Rebalance"\n        );\n\n        // Make sure all currentSets have been rebalanced\n        require(\n            _remainingCurrentSets < _minimumBid,\n            "RebalancingSetToken.settleRebalance: Rebalance not completed"\n        );\n\n        // Calculate next Set quantities\n        uint256 issueAmount;\n        uint256 nextUnitShares;\n        (\n            issueAmount,\n            nextUnitShares\n        ) = calculateNextSetIssueQuantity(\n            _totalSupply,\n            _naturalUnit,\n            _nextSet,\n            _vaultAddress\n        );\n\n        require(\n            nextUnitShares > 0,\n            "RebalancingSetToken.settleRebalance: Failed rebalance, unitshares equals 0. Call endFailedAuction."\n        );\n\n        // Issue nextSet to RebalancingSetToken\n        ICore(_coreAddress).issueInVault(\n            _nextSet,\n            issueAmount\n        );\n\n        return nextUnitShares;\n    }\n\n    /**\n     * Calculate the amount of nextSets to issue by using the component amounts in the\n     * vault, unitShares following from this calculation.\n     *\n     * @param   _totalSupply        Total supply of rebalancing set token\n     * @param   _naturalUnit        Natural unit of rebalancing set token\n     * @param   _nextSet            Address of next set\n     * @param   _vaultAddress       Vault address\n     * @return  uint256             Amount of nextSets to issue\n     * @return  uint256             New unitShares for the rebalancingSetToken\n     */\n    function calculateNextSetIssueQuantity(\n        uint256 _totalSupply,\n        uint256 _naturalUnit,\n        address _nextSet,\n        address _vaultAddress\n    )\n        public\n        view\n        returns (uint256, uint256)\n    {\n        // Collect data necessary to compute issueAmounts\n        SetTokenLibrary.SetDetails memory nextSetToken = SetTokenLibrary.getSetDetails(_nextSet);\n        uint256 maxIssueAmount = calculateMaxIssueAmount(\n            _vaultAddress,\n            nextSetToken\n        );\n\n        // Calculate the amount of naturalUnits worth of rebalancingSetToken outstanding\n        uint256 naturalUnitsOutstanding = _totalSupply.div(_naturalUnit);\n\n        // Issue amount of Sets that is closest multiple of nextNaturalUnit to the maxIssueAmount\n        // Since the initial division will round down to the nearest whole number when we multiply\n        // by that same number we will return the closest multiple less than the maxIssueAmount\n        uint256 issueAmount = maxIssueAmount.div(nextSetToken.naturalUnit).mul(nextSetToken.naturalUnit);\n\n        // Divide final issueAmount by naturalUnitsOutstanding to get newUnitShares\n        uint256 newUnitShares = issueAmount.div(naturalUnitsOutstanding);\n        return (issueAmount, newUnitShares);\n    }\n\n    /**\n     * Get the maximum possible issue amount of nextSet based on number of components owned by rebalancing\n     * set token.\n     *\n     * @param _vaultAddress     Vault address\n     * @param _setToken         nextSet details\n     * @return uint256          maxIssueAmount\n     */\n    function calculateMaxIssueAmount(\n        address _vaultAddress,\n        SetTokenLibrary.SetDetails memory _setToken\n    )\n        public\n        view\n        returns (uint256)\n    {\n        uint256 maxIssueAmount = CommonMath.maxUInt256();\n        IVault vaultInstance = IVault(_vaultAddress);\n\n        for (uint256 i = 0; i < _setToken.components.length; i++) {\n            // Get amount of components in vault owned by rebalancingSetToken\n            uint256 componentAmount = vaultInstance.getOwnerBalance(\n                _setToken.components[i],\n                address(this)\n            );\n\n            // Calculate amount of Sets that can be issued from those components, if less than amount for other\n            // components then set that as maxIssueAmount\n            uint256 componentIssueAmount = componentAmount.div(_setToken.units[i]).mul(_setToken.naturalUnit);\n            if (componentIssueAmount < maxIssueAmount) {\n                maxIssueAmount = componentIssueAmount;\n            }\n        }\n\n        return maxIssueAmount;\n    }\n}\n',
sourcePath:"/Users/justin_chen/Dropbox/workspace/set-protocol-contracts/contracts/core/tokens/rebalancing-libraries/SettleRebalanceLibrary.sol",ast:{absolutePath:"/Users/justin_chen/Dropbox/workspace/set-protocol-contracts/contracts/core/tokens/rebalancing-libraries/SettleRebalanceLibrary.sol",exportedSymbols:{SettleRebalanceLibrary:[17908]},id:17909,nodeType:"SourceUnit",nodes:[{id:17677,literals:["solidity","0.5",".7"],nodeType:"PragmaDirective",src:"597:22:78"},{id:17678,literals:["experimental","ABIEncoderV2"],nodeType:"PragmaDirective",src:"620:35:78"},{absolutePath:"openzeppelin-solidity/contracts/math/Math.sol",file:"openzeppelin-solidity/contracts/math/Math.sol",id:17680,nodeType:"ImportDirective",scope:17909,sourceUnit:29513,src:"657:69:78",symbolAliases:[{foreign:17679,local:null}],unitAlias:""},{absolutePath:"openzeppelin-solidity/contracts/math/SafeMath.sol",file:"openzeppelin-solidity/contracts/math/SafeMath.sol",id:17682,nodeType:"ImportDirective",scope:17909,sourceUnit:29641,src:"727:77:78",symbolAliases:[{foreign:17681,local:null}],unitAlias:""},{absolutePath:"/Users/justin_chen/Dropbox/workspace/set-protocol-contracts/contracts/lib/CommonMath.sol",file:"../../../lib/CommonMath.sol",id:17684,nodeType:"ImportDirective",scope:17909,sourceUnit:23437,src:"806:57:78",symbolAliases:[{foreign:17683,local:null}],unitAlias:""},{absolutePath:"/Users/justin_chen/Dropbox/workspace/set-protocol-contracts/contracts/core/interfaces/ICore.sol",file:"../../interfaces/ICore.sol",id:17686,nodeType:"ImportDirective",scope:17909,sourceUnit:4747,src:"864:51:78",symbolAliases:[{foreign:17685,local:null}],unitAlias:""},{absolutePath:"/Users/justin_chen/Dropbox/workspace/set-protocol-contracts/contracts/core/interfaces/IVault.sol",file:"../../interfaces/IVault.sol",id:17688,nodeType:"ImportDirective",scope:17909,sourceUnit:5783,src:"916:53:78",symbolAliases:[{foreign:17687,local:null}],unitAlias:""},{absolutePath:"/Users/justin_chen/Dropbox/workspace/set-protocol-contracts/contracts/core/interfaces/ISetToken.sol",file:"../../interfaces/ISetToken.sol",id:17690,nodeType:"ImportDirective",scope:17909,sourceUnit:5660,src:"970:59:78",symbolAliases:[{foreign:17689,local:null}],unitAlias:""},{absolutePath:"/Users/justin_chen/Dropbox/workspace/set-protocol-contracts/contracts/core/lib/RebalancingLibrary.sol",file:"../../lib/RebalancingLibrary.sol",id:17692,nodeType:"ImportDirective",scope:17909,sourceUnit:6658,src:"1030:70:78",symbolAliases:[{foreign:17691,local:null}],unitAlias:""},{absolutePath:"/Users/justin_chen/Dropbox/workspace/set-protocol-contracts/contracts/core/lib/SetTokenLibrary.sol",file:"../../lib/SetTokenLibrary.sol",id:17694,nodeType:"ImportDirective",scope:17909,sourceUnit:6842,src:"1101:64:78",symbolAliases:[{foreign:17693,local:null}],unitAlias:""},{baseContracts:[],contractDependencies:[],contractKind:"library",documentation:"@title SettleRebalanceLibrary\n@author Set Protocol\n * Default implementation of Rebalancing Set Token settle rebalance and related functions.",fullyImplemented:true,id:17908,linearizedBaseContracts:[17908],name:"SettleRebalanceLibrary",nodeType:"ContractDefinition",nodes:[{id:17697,libraryName:{contractScope:null,id:17695,name:"SafeMath",nodeType:"UserDefinedTypeName",referencedDeclaration:29640,src:"1370:8:78",typeDescriptions:{typeIdentifier:"t_contract$_SafeMath_$29640",typeString:"library SafeMath"}},nodeType:"UsingForDirective",src:"1364:27:78",typeName:{id:17696,name:"uint256",nodeType:"ElementaryTypeName",src:"1383:7:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}}},{body:{id:17770,nodeType:"Block",src:"2494:1125:78",statements:[{expression:{argumentTypes:null,arguments:[{argumentTypes:null,commonType:{typeIdentifier:"t_uint8",typeString:"uint8"},id:17725,isConstant:false,isLValue:false,isPure:false,lValueRequested:false,leftExpression:{argumentTypes:null,id:17719,name:"_rebalanceState",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17713,src:"2582:15:78",typeDescriptions:{typeIdentifier:"t_uint8",typeString:"uint8"}},nodeType:"BinaryOperation",operator:"==",rightExpression:{argumentTypes:null,arguments:[{argumentTypes:null,expression:{argumentTypes:null,expression:{argumentTypes:null,id:17721,name:"RebalancingLibrary",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:6657,src:"2607:18:78",typeDescriptions:{typeIdentifier:"t_type$_t_contract$_RebalancingLibrary_$6657_$",typeString:"type(library RebalancingLibrary)"}},id:17722,isConstant:false,isLValue:false,isPure:false,lValueRequested:false,memberName:"State",nodeType:"MemberAccess",referencedDeclaration:6633,src:"2607:24:78",typeDescriptions:{typeIdentifier:"t_type$_t_enum$_State_$6633_$",typeString:"type(enum RebalancingLibrary.State)"}},id:17723,isConstant:false,isLValue:false,isPure:true,lValueRequested:false,memberName:"Rebalance",nodeType:"MemberAccess",referencedDeclaration:null,src:"2607:34:78",typeDescriptions:{typeIdentifier:"t_enum$_State_$6633",typeString:"enum RebalancingLibrary.State"}}],expression:{argumentTypes:[{typeIdentifier:"t_enum$_State_$6633",typeString:"enum RebalancingLibrary.State"}],id:17720,isConstant:false,isLValue:false,isPure:true,lValueRequested:false,nodeType:"ElementaryTypeNameExpression",src:"2601:5:78",typeDescriptions:{typeIdentifier:"t_type$_t_uint8_$",typeString:"type(uint8)"},typeName:"uint8"},id:17724,isConstant:false,isLValue:false,isPure:true,kind:"typeConversion",lValueRequested:false,names:[],nodeType:"FunctionCall",src:"2601:41:78",typeDescriptions:{typeIdentifier:"t_uint8",typeString:"uint8"}},src:"2582:60:78",typeDescriptions:{typeIdentifier:"t_bool",typeString:"bool"}},{argumentTypes:null,hexValue:"526562616c616e63696e67536574546f6b656e2e736574746c65526562616c616e63653a205374617465206d75737420626520526562616c616e6365",id:17726,isConstant:false,isLValue:false,isPure:true,kind:"string",lValueRequested:false,nodeType:"Literal",src:"2656:62:78",subdenomination:null,typeDescriptions:{typeIdentifier:"t_stringliteral_317be77dcae752c2e504ffbe32fac8453b82dd0ff05c8a7270fa54f560e89120",typeString:'literal_string "RebalancingSetToken.settleRebalance: State must be Rebalance"'},value:"RebalancingSetToken.settleRebalance: State must be Rebalance"}],expression:{argumentTypes:[{typeIdentifier:"t_bool",typeString:"bool"},{typeIdentifier:"t_stringliteral_317be77dcae752c2e504ffbe32fac8453b82dd0ff05c8a7270fa54f560e89120",typeString:'literal_string "RebalancingSetToken.settleRebalance: State must be Rebalance"'}],id:17718,name:"require",nodeType:"Identifier",overloadedDeclarations:[30379,30380],referencedDeclaration:30380,src:"2561:7:78",typeDescriptions:{typeIdentifier:"t_function_require_pure$_t_bool_$_t_string_memory_ptr_$returns$__$",typeString:"function (bool,string memory) pure"}},id:17727,isConstant:false,isLValue:false,isPure:false,kind:"functionCall",lValueRequested:false,names:[],nodeType:"FunctionCall",src:"2561:167:78",typeDescriptions:{typeIdentifier:"t_tuple$__$",typeString:"tuple()"}},id:17728,nodeType:"ExpressionStatement",src:"2561:167:78"},{expression:{argumentTypes:null,arguments:[{argumentTypes:null,commonType:{typeIdentifier:"t_uint256",typeString:"uint256"},id:17732,isConstant:false,isLValue:false,isPure:false,lValueRequested:false,leftExpression:{argumentTypes:null,id:17730,name:"_remainingCurrentSets",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17701,src:"2818:21:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},nodeType:"BinaryOperation",operator:"<",rightExpression:{argumentTypes:null,id:17731,name:"_minimumBid",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17703,src:"2842:11:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},src:"2818:35:78",typeDescriptions:{typeIdentifier:"t_bool",typeString:"bool"}},{argumentTypes:null,hexValue:"526562616c616e63696e67536574546f6b656e2e736574746c65526562616c616e63653a20526562616c616e6365206e6f7420636f6d706c65746564",id:17733,isConstant:false,isLValue:false,isPure:true,kind:"string",lValueRequested:false,nodeType:"Literal",src:"2867:62:78",subdenomination:null,typeDescriptions:{typeIdentifier:"t_stringliteral_0d401484e2b49f5a01e3012eb88fd4ccc19a6e73d6f8b7f18eef6ad7f1008d14",typeString:'literal_string "RebalancingSetToken.settleRebalance: Rebalance not completed"'},value:"RebalancingSetToken.settleRebalance: Rebalance not completed"}],expression:{argumentTypes:[{typeIdentifier:"t_bool",typeString:"bool"},{typeIdentifier:"t_stringliteral_0d401484e2b49f5a01e3012eb88fd4ccc19a6e73d6f8b7f18eef6ad7f1008d14",typeString:'literal_string "RebalancingSetToken.settleRebalance: Rebalance not completed"'}],id:17729,name:"require",nodeType:"Identifier",overloadedDeclarations:[30379,30380],referencedDeclaration:30380,src:"2797:7:78",typeDescriptions:{typeIdentifier:"t_function_require_pure$_t_bool_$_t_string_memory_ptr_$returns$__$",typeString:"function (bool,string memory) pure"}},id:17734,isConstant:false,isLValue:false,isPure:false,kind:"functionCall",lValueRequested:false,names:[],nodeType:"FunctionCall",src:"2797:142:78",typeDescriptions:{typeIdentifier:"t_tuple$__$",typeString:"tuple()"}},id:17735,nodeType:"ExpressionStatement",src:"2797:142:78"},{assignments:[17737],declarations:[{constant:false,id:17737,name:"issueAmount",nodeType:"VariableDeclaration",scope:17770,src:"2991:19:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"},typeName:{id:17736,name:"uint256",nodeType:"ElementaryTypeName",src:"2991:7:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},value:null,visibility:"internal"}],id:17738,initialValue:null,nodeType:"VariableDeclarationStatement",src:"2991:19:78"},{assignments:[17740],declarations:[{constant:false,id:17740,name:"nextUnitShares",nodeType:"VariableDeclaration",scope:17770,src:"3020:22:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"},typeName:{id:17739,name:"uint256",nodeType:"ElementaryTypeName",src:"3020:7:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},value:null,visibility:"internal"}],id:17741,initialValue:null,nodeType:"VariableDeclarationStatement",src:"3020:22:78"},{expression:{argumentTypes:null,id:17751,isConstant:false,isLValue:false,isPure:false,lValueRequested:false,leftHandSide:{argumentTypes:null,components:[{argumentTypes:null,id:17742,name:"issueAmount",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17737,src:"3066:11:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},{argumentTypes:null,id:17743,name:"nextUnitShares",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17740,src:"3091:14:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}}],id:17744,isConstant:false,isInlineArray:false,isLValue:true,isPure:false,lValueRequested:true,nodeType:"TupleExpression",src:"3052:63:78",typeDescriptions:{typeIdentifier:"t_tuple$_t_uint256_$_t_uint256_$",typeString:"tuple(uint256,uint256)"}},nodeType:"Assignment",operator:"=",rightHandSide:{argumentTypes:null,arguments:[{argumentTypes:null,id:17746,name:"_totalSupply",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17699,src:"3161:12:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},{argumentTypes:null,id:17747,name:"_naturalUnit",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17705,src:"3187:12:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},{argumentTypes:null,id:17748,name:"_nextSet",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17707,src:"3213:8:78",typeDescriptions:{typeIdentifier:"t_address",typeString:"address"}},{argumentTypes:null,id:17749,name:"_vaultAddress",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17711,src:"3235:13:78",typeDescriptions:{typeIdentifier:"t_address",typeString:"address"}}],expression:{argumentTypes:[{typeIdentifier:"t_uint256",typeString:"uint256"},{typeIdentifier:"t_uint256",typeString:"uint256"},{typeIdentifier:"t_address",typeString:"address"},{typeIdentifier:"t_address",typeString:"address"}],id:17745,name:"calculateNextSetIssueQuantity",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17833,src:"3118:29:78",typeDescriptions:{typeIdentifier:"t_function_internal_view$_t_uint256_$_t_uint256_$_t_address_$_t_address_$returns$_t_uint256_$_t_uint256_$",typeString:"function (uint256,uint256,address,address) view returns (uint256,uint256)"}},id:17750,isConstant:false,isLValue:false,isPure:false,kind:"functionCall",lValueRequested:false,names:[],nodeType:"FunctionCall",src:"3118:140:78",typeDescriptions:{typeIdentifier:"t_tuple$_t_uint256_$_t_uint256_$",typeString:"tuple(uint256,uint256)"}},src:"3052:206:78",typeDescriptions:{typeIdentifier:"t_tuple$__$",typeString:"tuple()"}},id:17752,nodeType:"ExpressionStatement",src:"3052:206:78"},{expression:{argumentTypes:null,arguments:[{argumentTypes:null,commonType:{typeIdentifier:"t_uint256",typeString:"uint256"},id:17756,isConstant:false,isLValue:false,isPure:false,lValueRequested:false,leftExpression:{argumentTypes:null,id:17754,name:"nextUnitShares",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17740,src:"3290:14:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},nodeType:"BinaryOperation",operator:">",rightExpression:{argumentTypes:null,hexValue:"30",id:17755,isConstant:false,isLValue:false,isPure:true,kind:"number",lValueRequested:false,nodeType:"Literal",src:"3307:1:78",subdenomination:null,typeDescriptions:{typeIdentifier:"t_rational_0_by_1",typeString:"int_const 0"},value:"0"},src:"3290:18:78",typeDescriptions:{typeIdentifier:"t_bool",typeString:"bool"}},{argumentTypes:null,hexValue:"526562616c616e63696e67536574546f6b656e2e736574746c65526562616c616e63653a204661696c656420726562616c616e63652c20756e697473686172657320657175616c7320302e2043616c6c20656e644661696c656441756374696f6e2e",id:17757,isConstant:false,isLValue:false,isPure:true,kind:"string",lValueRequested:false,nodeType:"Literal",src:"3322:100:78",subdenomination:null,typeDescriptions:{typeIdentifier:"t_stringliteral_2362f766e8e4d46310b53662e15cfa10ffbe720c9a9671204521098799a2cbcc",typeString:'literal_string "RebalancingSetToken.settleRebalance: Failed rebalance, unitshares equals 0. Call endFailedAuction."'},value:"RebalancingSetToken.settleRebalance: Failed rebalance, unitshares equals 0. Call endFailedAuction."}],expression:{argumentTypes:[{typeIdentifier:"t_bool",typeString:"bool"},{typeIdentifier:"t_stringliteral_2362f766e8e4d46310b53662e15cfa10ffbe720c9a9671204521098799a2cbcc",typeString:'literal_string "RebalancingSetToken.settleRebalance: Failed rebalance, unitshares equals 0. Call endFailedAuction."'}],id:17753,name:"require",nodeType:"Identifier",overloadedDeclarations:[30379,30380],referencedDeclaration:30380,src:"3269:7:78",typeDescriptions:{typeIdentifier:"t_function_require_pure$_t_bool_$_t_string_memory_ptr_$returns$__$",typeString:"function (bool,string memory) pure"}},id:17758,isConstant:false,isLValue:false,isPure:false,kind:"functionCall",lValueRequested:false,names:[],nodeType:"FunctionCall",src:"3269:163:78",typeDescriptions:{typeIdentifier:"t_tuple$__$",typeString:"tuple()"}},id:17759,nodeType:"ExpressionStatement",src:"3269:163:78"},{expression:{argumentTypes:null,arguments:[{argumentTypes:null,id:17764,name:"_nextSet",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17707,src:"3537:8:78",typeDescriptions:{typeIdentifier:"t_address",typeString:"address"}},{argumentTypes:null,id:17765,name:"issueAmount",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17737,src:"3559:11:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}}],expression:{argumentTypes:[{typeIdentifier:"t_address",typeString:"address"},{typeIdentifier:"t_uint256",typeString:"uint256"}],expression:{argumentTypes:null,arguments:[{argumentTypes:null,id:17761,name:"_coreAddress",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17709,src:"3497:12:78",typeDescriptions:{typeIdentifier:"t_address",typeString:"address"}}],expression:{argumentTypes:[{typeIdentifier:"t_address",typeString:"address"}],id:17760,name:"ICore",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:4746,src:"3491:5:78",typeDescriptions:{typeIdentifier:"t_type$_t_contract$_ICore_$4746_$",typeString:"type(contract ICore)"}},id:17762,isConstant:false,isLValue:false,isPure:false,kind:"typeConversion",lValueRequested:false,names:[],nodeType:"FunctionCall",src:"3491:19:78",typeDescriptions:{typeIdentifier:"t_contract$_ICore_$4746",typeString:"contract ICore"}},id:17763,isConstant:false,isLValue:false,isPure:false,lValueRequested:false,memberName:"issueInVault",nodeType:"MemberAccess",referencedDeclaration:4520,src:"3491:32:78",typeDescriptions:{typeIdentifier:"t_function_external_nonpayable$_t_address_$_t_uint256_$returns$__$",typeString:"function (address,uint256) external"}},id:17766,isConstant:false,isLValue:false,isPure:false,kind:"functionCall",lValueRequested:false,names:[],nodeType:"FunctionCall",src:"3491:89:78",typeDescriptions:{typeIdentifier:"t_tuple$__$",typeString:"tuple()"}},id:17767,nodeType:"ExpressionStatement",src:"3491:89:78"},{expression:{argumentTypes:null,id:17768,name:"nextUnitShares",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17740,src:"3598:14:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},functionReturnParameters:17717,id:17769,nodeType:"Return",src:"3591:21:78"}]},documentation:"Calculate the amount of nextSets to issue by using the component amounts in the\nvault, new unitShares follow from this calculation\n     * @param   _totalSupply            Total supply of rebalancing set token\n@param   _remainingCurrentSets   Amount of currentSets remaining\n@param   _minimumBid             Minimum bid allowed, used to see if valid settle\n@param   _naturalUnit            Natural unit of rebalancing set token\n@param   _nextSet                Address of next set\n@param   _coreAddress            Core address\n@param   _vaultAddress           Vault address\n@return  uint256                 Amount of nextSets to issue",id:17771,implemented:true,kind:"function",modifiers:[],name:"settleRebalance",nodeType:"FunctionDefinition",parameters:{id:17714,nodeType:"ParameterList",parameters:[{constant:false,id:17699,name:"_totalSupply",nodeType:"VariableDeclaration",scope:17771,src:"2206:20:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"},typeName:{id:17698,name:"uint256",nodeType:"ElementaryTypeName",src:"2206:7:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},value:null,visibility:"internal"},{constant:false,id:17701,name:"_remainingCurrentSets",nodeType:"VariableDeclaration",scope:17771,src:"2236:29:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"},typeName:{id:17700,name:"uint256",nodeType:"ElementaryTypeName",src:"2236:7:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},value:null,visibility:"internal"},{constant:false,id:17703,name:"_minimumBid",nodeType:"VariableDeclaration",scope:17771,src:"2275:19:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"},typeName:{id:17702,name:"uint256",nodeType:"ElementaryTypeName",src:"2275:7:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},value:null,visibility:"internal"},{constant:false,id:17705,name:"_naturalUnit",nodeType:"VariableDeclaration",scope:17771,src:"2304:20:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"},typeName:{id:17704,name:"uint256",nodeType:"ElementaryTypeName",src:"2304:7:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},value:null,visibility:"internal"},{constant:false,id:17707,name:"_nextSet",nodeType:"VariableDeclaration",scope:17771,src:"2334:16:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_address",typeString:"address"},typeName:{id:17706,name:"address",nodeType:"ElementaryTypeName",src:"2334:7:78",stateMutability:"nonpayable",typeDescriptions:{typeIdentifier:"t_address",typeString:"address"}},value:null,visibility:"internal"},{constant:false,id:17709,name:"_coreAddress",nodeType:"VariableDeclaration",scope:17771,src:"2360:20:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_address",typeString:"address"},typeName:{id:17708,name:"address",nodeType:"ElementaryTypeName",src:"2360:7:78",stateMutability:"nonpayable",typeDescriptions:{typeIdentifier:"t_address",typeString:"address"}},value:null,visibility:"internal"},{constant:false,id:17711,name:"_vaultAddress",nodeType:"VariableDeclaration",scope:17771,src:"2390:21:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_address",typeString:"address"},typeName:{id:17710,name:"address",nodeType:"ElementaryTypeName",src:"2390:7:78",stateMutability:"nonpayable",typeDescriptions:{typeIdentifier:"t_address",typeString:"address"}},value:null,visibility:"internal"},{constant:false,id:17713,name:"_rebalanceState",nodeType:"VariableDeclaration",scope:17771,src:"2421:21:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_uint8",typeString:"uint8"},typeName:{id:17712,name:"uint8",nodeType:"ElementaryTypeName",src:"2421:5:78",typeDescriptions:{typeIdentifier:"t_uint8",typeString:"uint8"}},value:null,visibility:"internal"}],src:"2196:252:78"},returnParameters:{id:17717,nodeType:"ParameterList",parameters:[{constant:false,id:17716,name:"",nodeType:"VariableDeclaration",scope:17771,src:"2481:7:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"},typeName:{id:17715,name:"uint256",nodeType:"ElementaryTypeName",src:"2481:7:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},value:null,visibility:"internal"}],src:"2480:9:78"},scope:17908,src:"2172:1447:78",stateMutability:"nonpayable",superFunction:null,visibility:"public"},{body:{id:17832,nodeType:"Block",src:"4419:1052:78",statements:[{assignments:[17789],declarations:[{constant:false,id:17789,name:"nextSetToken",nodeType:"VariableDeclaration",scope:17832,src:"4487:46:78",stateVariable:false,storageLocation:"memory",typeDescriptions:{typeIdentifier:"t_struct$_SetDetails_$6726_memory_ptr",typeString:"struct SetTokenLibrary.SetDetails"},typeName:{contractScope:null,id:17788,name:"SetTokenLibrary.SetDetails",nodeType:"UserDefinedTypeName",referencedDeclaration:6726,src:"4487:26:78",typeDescriptions:{typeIdentifier:"t_struct$_SetDetails_$6726_storage_ptr",typeString:"struct SetTokenLibrary.SetDetails"}},value:null,visibility:"internal"}],id:17794,initialValue:{argumentTypes:null,arguments:[{argumentTypes:null,id:17792,name:"_nextSet",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17777,src:"4566:8:78",typeDescriptions:{typeIdentifier:"t_address",typeString:"address"}}],expression:{argumentTypes:[{typeIdentifier:"t_address",typeString:"address"}],expression:{argumentTypes:null,id:17790,name:"SetTokenLibrary",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:6841,src:"4536:15:78",typeDescriptions:{typeIdentifier:"t_type$_t_contract$_SetTokenLibrary_$6841_$",typeString:"type(library SetTokenLibrary)"}},id:17791,isConstant:false,isLValue:false,isPure:false,lValueRequested:false,memberName:"getSetDetails",nodeType:"MemberAccess",referencedDeclaration:6840,src:"4536:29:78",typeDescriptions:{typeIdentifier:"t_function_internal_view$_t_address_$returns$_t_struct$_SetDetails_$6726_memory_ptr_$",typeString:"function (address) view returns (struct SetTokenLibrary.SetDetails memory)"}},id:17793,isConstant:false,isLValue:false,isPure:false,kind:"functionCall",lValueRequested:false,names:[],nodeType:"FunctionCall",src:"4536:39:78",typeDescriptions:{typeIdentifier:"t_struct$_SetDetails_$6726_memory_ptr",typeString:"struct SetTokenLibrary.SetDetails memory"}},nodeType:"VariableDeclarationStatement",src:"4487:88:78"},{assignments:[17796],declarations:[{constant:false,id:17796,name:"maxIssueAmount",nodeType:"VariableDeclaration",scope:17832,src:"4585:22:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"},typeName:{id:17795,name:"uint256",nodeType:"ElementaryTypeName",src:"4585:7:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},value:null,visibility:"internal"}],id:17801,initialValue:{argumentTypes:null,arguments:[{argumentTypes:null,id:17798,name:"_vaultAddress",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17779,src:"4647:13:78",typeDescriptions:{typeIdentifier:"t_address",typeString:"address"}},{argumentTypes:null,id:17799,name:"nextSetToken",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17789,src:"4674:12:78",typeDescriptions:{typeIdentifier:"t_struct$_SetDetails_$6726_memory_ptr",typeString:"struct SetTokenLibrary.SetDetails memory"}}],expression:{argumentTypes:[{typeIdentifier:"t_address",typeString:"address"},{typeIdentifier:"t_struct$_SetDetails_$6726_memory_ptr",typeString:"struct SetTokenLibrary.SetDetails memory"}],id:17797,name:"calculateMaxIssueAmount",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17907,src:"4610:23:78",typeDescriptions:{typeIdentifier:"t_function_internal_view$_t_address_$_t_struct$_SetDetails_$6726_memory_ptr_$returns$_t_uint256_$",typeString:"function (address,struct SetTokenLibrary.SetDetails memory) view returns (uint256)"}},id:17800,isConstant:false,isLValue:false,isPure:false,kind:"functionCall",lValueRequested:false,names:[],nodeType:"FunctionCall",src:"4610:86:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},nodeType:"VariableDeclarationStatement",src:"4585:111:78"},{assignments:[17803],declarations:[{constant:false,id:17803,name:"naturalUnitsOutstanding",nodeType:"VariableDeclaration",scope:17832,src:"4796:31:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"},typeName:{id:17802,name:"uint256",nodeType:"ElementaryTypeName",src:"4796:7:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},value:null,visibility:"internal"}],id:17808,initialValue:{argumentTypes:null,arguments:[{argumentTypes:null,id:17806,name:"_naturalUnit",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17775,src:"4847:12:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}}],expression:{argumentTypes:[{typeIdentifier:"t_uint256",typeString:"uint256"}],expression:{argumentTypes:null,id:17804,name:"_totalSupply",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17773,src:"4830:12:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},id:17805,isConstant:false,isLValue:false,isPure:false,lValueRequested:false,memberName:"div",nodeType:"MemberAccess",referencedDeclaration:29571,src:"4830:16:78",typeDescriptions:{typeIdentifier:"t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$bound_to$_t_uint256_$",typeString:"function (uint256,uint256) pure returns (uint256)"}},id:17807,isConstant:false,isLValue:false,isPure:false,kind:"functionCall",lValueRequested:false,names:[],nodeType:"FunctionCall",src:"4830:30:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},nodeType:"VariableDeclarationStatement",src:"4796:64:78"},{assignments:[17810],declarations:[{constant:false,id:17810,name:"issueAmount",nodeType:"VariableDeclaration",scope:17832,src:"5164:19:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"},typeName:{id:17809,name:"uint256",nodeType:"ElementaryTypeName",src:"5164:7:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},value:null,visibility:"internal"}],id:17820,initialValue:{argumentTypes:null,arguments:[{argumentTypes:null,expression:{argumentTypes:null,id:17817,name:"nextSetToken",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17789,src:"5235:12:78",typeDescriptions:{typeIdentifier:"t_struct$_SetDetails_$6726_memory_ptr",typeString:"struct SetTokenLibrary.SetDetails memory"}},id:17818,isConstant:false,isLValue:true,isPure:false,lValueRequested:false,memberName:"naturalUnit",nodeType:"MemberAccess",referencedDeclaration:6719,src:"5235:24:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}}],expression:{argumentTypes:[{typeIdentifier:"t_uint256",typeString:"uint256"}],expression:{argumentTypes:null,arguments:[{argumentTypes:null,expression:{argumentTypes:null,id:17813,name:"nextSetToken",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17789,src:"5205:12:78",typeDescriptions:{typeIdentifier:"t_struct$_SetDetails_$6726_memory_ptr",typeString:"struct SetTokenLibrary.SetDetails memory"}},id:17814,isConstant:false,isLValue:true,isPure:false,lValueRequested:false,memberName:"naturalUnit",nodeType:"MemberAccess",referencedDeclaration:6719,src:"5205:24:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}}],expression:{argumentTypes:[{typeIdentifier:"t_uint256",typeString:"uint256"}],expression:{argumentTypes:null,id:17811,name:"maxIssueAmount",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17796,src:"5186:14:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},id:17812,isConstant:false,isLValue:false,isPure:false,lValueRequested:false,memberName:"div",nodeType:"MemberAccess",referencedDeclaration:29571,src:"5186:18:78",typeDescriptions:{typeIdentifier:"t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$bound_to$_t_uint256_$",typeString:"function (uint256,uint256) pure returns (uint256)"}},id:17815,isConstant:false,isLValue:false,isPure:false,kind:"functionCall",lValueRequested:false,names:[],nodeType:"FunctionCall",src:"5186:44:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},id:17816,isConstant:false,isLValue:false,isPure:false,lValueRequested:false,memberName:"mul",nodeType:"MemberAccess",referencedDeclaration:29547,src:"5186:48:78",typeDescriptions:{typeIdentifier:"t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$bound_to$_t_uint256_$",typeString:"function (uint256,uint256) pure returns (uint256)"}},id:17819,isConstant:false,isLValue:false,isPure:false,kind:"functionCall",lValueRequested:false,names:[],nodeType:"FunctionCall",src:"5186:74:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},nodeType:"VariableDeclarationStatement",src:"5164:96:78"},{assignments:[17822],declarations:[{constant:false,id:17822,name:"newUnitShares",nodeType:"VariableDeclaration",scope:17832,src:"5355:21:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"},typeName:{id:17821,name:"uint256",nodeType:"ElementaryTypeName",src:"5355:7:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},value:null,visibility:"internal"}],id:17827,initialValue:{argumentTypes:null,arguments:[{argumentTypes:null,id:17825,name:"naturalUnitsOutstanding",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17803,src:"5395:23:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}}],expression:{argumentTypes:[{typeIdentifier:"t_uint256",typeString:"uint256"}],expression:{argumentTypes:null,id:17823,name:"issueAmount",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17810,src:"5379:11:78",typeDescriptions:{typeIdentifier:"t_uint256",
typeString:"uint256"}},id:17824,isConstant:false,isLValue:false,isPure:false,lValueRequested:false,memberName:"div",nodeType:"MemberAccess",referencedDeclaration:29571,src:"5379:15:78",typeDescriptions:{typeIdentifier:"t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$bound_to$_t_uint256_$",typeString:"function (uint256,uint256) pure returns (uint256)"}},id:17826,isConstant:false,isLValue:false,isPure:false,kind:"functionCall",lValueRequested:false,names:[],nodeType:"FunctionCall",src:"5379:40:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},nodeType:"VariableDeclarationStatement",src:"5355:64:78"},{expression:{argumentTypes:null,components:[{argumentTypes:null,id:17828,name:"issueAmount",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17810,src:"5437:11:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},{argumentTypes:null,id:17829,name:"newUnitShares",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17822,src:"5450:13:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}}],id:17830,isConstant:false,isInlineArray:false,isLValue:false,isPure:false,lValueRequested:false,nodeType:"TupleExpression",src:"5436:28:78",typeDescriptions:{typeIdentifier:"t_tuple$_t_uint256_$_t_uint256_$",typeString:"tuple(uint256,uint256)"}},functionReturnParameters:17785,id:17831,nodeType:"Return",src:"5429:35:78"}]},documentation:"Calculate the amount of nextSets to issue by using the component amounts in the\nvault, unitShares following from this calculation.\n     * @param   _totalSupply        Total supply of rebalancing set token\n@param   _naturalUnit        Natural unit of rebalancing set token\n@param   _nextSet            Address of next set\n@param   _vaultAddress       Vault address\n@return  uint256             Amount of nextSets to issue\n@return  uint256             New unitShares for the rebalancingSetToken",id:17833,implemented:true,kind:"function",modifiers:[],name:"calculateNextSetIssueQuantity",nodeType:"FunctionDefinition",parameters:{id:17780,nodeType:"ParameterList",parameters:[{constant:false,id:17773,name:"_totalSupply",nodeType:"VariableDeclaration",scope:17833,src:"4238:20:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"},typeName:{id:17772,name:"uint256",nodeType:"ElementaryTypeName",src:"4238:7:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},value:null,visibility:"internal"},{constant:false,id:17775,name:"_naturalUnit",nodeType:"VariableDeclaration",scope:17833,src:"4268:20:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"},typeName:{id:17774,name:"uint256",nodeType:"ElementaryTypeName",src:"4268:7:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},value:null,visibility:"internal"},{constant:false,id:17777,name:"_nextSet",nodeType:"VariableDeclaration",scope:17833,src:"4298:16:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_address",typeString:"address"},typeName:{id:17776,name:"address",nodeType:"ElementaryTypeName",src:"4298:7:78",stateMutability:"nonpayable",typeDescriptions:{typeIdentifier:"t_address",typeString:"address"}},value:null,visibility:"internal"},{constant:false,id:17779,name:"_vaultAddress",nodeType:"VariableDeclaration",scope:17833,src:"4324:21:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_address",typeString:"address"},typeName:{id:17778,name:"address",nodeType:"ElementaryTypeName",src:"4324:7:78",stateMutability:"nonpayable",typeDescriptions:{typeIdentifier:"t_address",typeString:"address"}},value:null,visibility:"internal"}],src:"4228:123:78"},returnParameters:{id:17785,nodeType:"ParameterList",parameters:[{constant:false,id:17782,name:"",nodeType:"VariableDeclaration",scope:17833,src:"4397:7:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"},typeName:{id:17781,name:"uint256",nodeType:"ElementaryTypeName",src:"4397:7:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},value:null,visibility:"internal"},{constant:false,id:17784,name:"",nodeType:"VariableDeclaration",scope:17833,src:"4406:7:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"},typeName:{id:17783,name:"uint256",nodeType:"ElementaryTypeName",src:"4406:7:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},value:null,visibility:"internal"}],src:"4396:18:78"},scope:17908,src:"4190:1281:78",stateMutability:"view",superFunction:null,visibility:"public"},{body:{id:17906,nodeType:"Block",src:"5947:871:78",statements:[{assignments:[17843],declarations:[{constant:false,id:17843,name:"maxIssueAmount",nodeType:"VariableDeclaration",scope:17906,src:"5957:22:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"},typeName:{id:17842,name:"uint256",nodeType:"ElementaryTypeName",src:"5957:7:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},value:null,visibility:"internal"}],id:17847,initialValue:{argumentTypes:null,arguments:[],expression:{argumentTypes:[],expression:{argumentTypes:null,id:17844,name:"CommonMath",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:23436,src:"5982:10:78",typeDescriptions:{typeIdentifier:"t_type$_t_contract$_CommonMath_$23436_$",typeString:"type(library CommonMath)"}},id:17845,isConstant:false,isLValue:false,isPure:false,lValueRequested:false,memberName:"maxUInt256",nodeType:"MemberAccess",referencedDeclaration:23132,src:"5982:21:78",typeDescriptions:{typeIdentifier:"t_function_internal_pure$__$returns$_t_uint256_$",typeString:"function () pure returns (uint256)"}},id:17846,isConstant:false,isLValue:false,isPure:false,kind:"functionCall",lValueRequested:false,names:[],nodeType:"FunctionCall",src:"5982:23:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},nodeType:"VariableDeclarationStatement",src:"5957:48:78"},{assignments:[17849],declarations:[{constant:false,id:17849,name:"vaultInstance",nodeType:"VariableDeclaration",scope:17906,src:"6015:20:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_contract$_IVault_$5782",typeString:"contract IVault"},typeName:{contractScope:null,id:17848,name:"IVault",nodeType:"UserDefinedTypeName",referencedDeclaration:5782,src:"6015:6:78",typeDescriptions:{typeIdentifier:"t_contract$_IVault_$5782",typeString:"contract IVault"}},value:null,visibility:"internal"}],id:17853,initialValue:{argumentTypes:null,arguments:[{argumentTypes:null,id:17851,name:"_vaultAddress",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17835,src:"6045:13:78",typeDescriptions:{typeIdentifier:"t_address",typeString:"address"}}],expression:{argumentTypes:[{typeIdentifier:"t_address",typeString:"address"}],id:17850,name:"IVault",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:5782,src:"6038:6:78",typeDescriptions:{typeIdentifier:"t_type$_t_contract$_IVault_$5782_$",typeString:"type(contract IVault)"}},id:17852,isConstant:false,isLValue:false,isPure:false,kind:"typeConversion",lValueRequested:false,names:[],nodeType:"FunctionCall",src:"6038:21:78",typeDescriptions:{typeIdentifier:"t_contract$_IVault_$5782",typeString:"contract IVault"}},nodeType:"VariableDeclarationStatement",src:"6015:44:78"},{body:{id:17902,nodeType:"Block",src:"6128:652:78",statements:[{assignments:[17867],declarations:[{constant:false,id:17867,name:"componentAmount",nodeType:"VariableDeclaration",scope:17902,src:"6220:23:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"},typeName:{id:17866,name:"uint256",nodeType:"ElementaryTypeName",src:"6220:7:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},value:null,visibility:"internal"}],id:17878,initialValue:{argumentTypes:null,arguments:[{argumentTypes:null,baseExpression:{argumentTypes:null,expression:{argumentTypes:null,id:17870,name:"_setToken",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17837,src:"6293:9:78",typeDescriptions:{typeIdentifier:"t_struct$_SetDetails_$6726_memory_ptr",typeString:"struct SetTokenLibrary.SetDetails memory"}},id:17871,isConstant:false,isLValue:true,isPure:false,lValueRequested:false,memberName:"components",nodeType:"MemberAccess",referencedDeclaration:6722,src:"6293:20:78",typeDescriptions:{typeIdentifier:"t_array$_t_address_$dyn_memory",typeString:"address[] memory"}},id:17873,indexExpression:{argumentTypes:null,id:17872,name:"i",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17855,src:"6314:1:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},isConstant:false,isLValue:true,isPure:false,lValueRequested:false,nodeType:"IndexAccess",src:"6293:23:78",typeDescriptions:{typeIdentifier:"t_address",typeString:"address"}},{argumentTypes:null,arguments:[{argumentTypes:null,id:17875,name:"this",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:30590,src:"6342:4:78",typeDescriptions:{typeIdentifier:"t_contract$_SettleRebalanceLibrary_$17908",typeString:"library SettleRebalanceLibrary"}}],expression:{argumentTypes:[{typeIdentifier:"t_contract$_SettleRebalanceLibrary_$17908",typeString:"library SettleRebalanceLibrary"}],id:17874,isConstant:false,isLValue:false,isPure:true,lValueRequested:false,nodeType:"ElementaryTypeNameExpression",src:"6334:7:78",typeDescriptions:{typeIdentifier:"t_type$_t_address_$",typeString:"type(address)"},typeName:"address"},id:17876,isConstant:false,isLValue:false,isPure:false,kind:"typeConversion",lValueRequested:false,names:[],nodeType:"FunctionCall",src:"6334:13:78",typeDescriptions:{typeIdentifier:"t_address",typeString:"address"}}],expression:{argumentTypes:[{typeIdentifier:"t_address",typeString:"address"},{typeIdentifier:"t_address",typeString:"address"}],expression:{argumentTypes:null,id:17868,name:"vaultInstance",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17849,src:"6246:13:78",typeDescriptions:{typeIdentifier:"t_contract$_IVault_$5782",typeString:"contract IVault"}},id:17869,isConstant:false,isLValue:false,isPure:false,lValueRequested:false,memberName:"getOwnerBalance",nodeType:"MemberAccess",referencedDeclaration:5781,src:"6246:29:78",typeDescriptions:{typeIdentifier:"t_function_external_view$_t_address_$_t_address_$returns$_t_uint256_$",typeString:"function (address,address) view external returns (uint256)"}},id:17877,isConstant:false,isLValue:false,isPure:false,kind:"functionCall",lValueRequested:false,names:[],nodeType:"FunctionCall",src:"6246:115:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},nodeType:"VariableDeclarationStatement",src:"6220:141:78"},{assignments:[17880],declarations:[{constant:false,id:17880,name:"componentIssueAmount",nodeType:"VariableDeclaration",scope:17902,src:"6546:28:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"},typeName:{id:17879,name:"uint256",nodeType:"ElementaryTypeName",src:"6546:7:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},value:null,visibility:"internal"}],id:17892,initialValue:{argumentTypes:null,arguments:[{argumentTypes:null,expression:{argumentTypes:null,id:17889,name:"_setToken",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17837,src:"6621:9:78",typeDescriptions:{typeIdentifier:"t_struct$_SetDetails_$6726_memory_ptr",typeString:"struct SetTokenLibrary.SetDetails memory"}},id:17890,isConstant:false,isLValue:true,isPure:false,lValueRequested:false,memberName:"naturalUnit",nodeType:"MemberAccess",referencedDeclaration:6719,src:"6621:21:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}}],expression:{argumentTypes:[{typeIdentifier:"t_uint256",typeString:"uint256"}],expression:{argumentTypes:null,arguments:[{argumentTypes:null,baseExpression:{argumentTypes:null,expression:{argumentTypes:null,id:17883,name:"_setToken",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17837,src:"6597:9:78",typeDescriptions:{typeIdentifier:"t_struct$_SetDetails_$6726_memory_ptr",typeString:"struct SetTokenLibrary.SetDetails memory"}},id:17884,isConstant:false,isLValue:true,isPure:false,lValueRequested:false,memberName:"units",nodeType:"MemberAccess",referencedDeclaration:6725,src:"6597:15:78",typeDescriptions:{typeIdentifier:"t_array$_t_uint256_$dyn_memory",typeString:"uint256[] memory"}},id:17886,indexExpression:{argumentTypes:null,id:17885,name:"i",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17855,src:"6613:1:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},isConstant:false,isLValue:true,isPure:false,lValueRequested:false,nodeType:"IndexAccess",src:"6597:18:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}}],expression:{argumentTypes:[{typeIdentifier:"t_uint256",typeString:"uint256"}],expression:{argumentTypes:null,id:17881,name:"componentAmount",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17867,src:"6577:15:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},id:17882,isConstant:false,isLValue:false,isPure:false,lValueRequested:false,memberName:"div",nodeType:"MemberAccess",referencedDeclaration:29571,src:"6577:19:78",typeDescriptions:{typeIdentifier:"t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$bound_to$_t_uint256_$",typeString:"function (uint256,uint256) pure returns (uint256)"}},id:17887,isConstant:false,isLValue:false,isPure:false,kind:"functionCall",lValueRequested:false,names:[],nodeType:"FunctionCall",src:"6577:39:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},id:17888,isConstant:false,isLValue:false,isPure:false,lValueRequested:false,memberName:"mul",nodeType:"MemberAccess",referencedDeclaration:29547,src:"6577:43:78",typeDescriptions:{typeIdentifier:"t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$bound_to$_t_uint256_$",typeString:"function (uint256,uint256) pure returns (uint256)"}},id:17891,isConstant:false,isLValue:false,isPure:false,kind:"functionCall",lValueRequested:false,names:[],nodeType:"FunctionCall",src:"6577:66:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},nodeType:"VariableDeclarationStatement",src:"6546:97:78"},{condition:{argumentTypes:null,commonType:{typeIdentifier:"t_uint256",typeString:"uint256"},id:17895,isConstant:false,isLValue:false,isPure:false,lValueRequested:false,leftExpression:{argumentTypes:null,id:17893,name:"componentIssueAmount",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17880,src:"6661:20:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},nodeType:"BinaryOperation",operator:"<",rightExpression:{argumentTypes:null,id:17894,name:"maxIssueAmount",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17843,src:"6684:14:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},src:"6661:37:78",typeDescriptions:{typeIdentifier:"t_bool",typeString:"bool"}},falseBody:null,id:17901,nodeType:"IfStatement",src:"6657:113:78",trueBody:{id:17900,nodeType:"Block",src:"6700:70:78",statements:[{expression:{argumentTypes:null,id:17898,isConstant:false,isLValue:false,isPure:false,lValueRequested:false,leftHandSide:{argumentTypes:null,id:17896,name:"maxIssueAmount",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17843,src:"6718:14:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},nodeType:"Assignment",operator:"=",rightHandSide:{argumentTypes:null,id:17897,name:"componentIssueAmount",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17880,src:"6735:20:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},src:"6718:37:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},id:17899,nodeType:"ExpressionStatement",src:"6718:37:78"}]}}]},condition:{argumentTypes:null,commonType:{typeIdentifier:"t_uint256",typeString:"uint256"},id:17862,isConstant:false,isLValue:false,isPure:false,lValueRequested:false,leftExpression:{argumentTypes:null,id:17858,name:"i",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17855,src:"6090:1:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},nodeType:"BinaryOperation",operator:"<",rightExpression:{argumentTypes:null,expression:{argumentTypes:null,expression:{argumentTypes:null,id:17859,name:"_setToken",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17837,src:"6094:9:78",typeDescriptions:{typeIdentifier:"t_struct$_SetDetails_$6726_memory_ptr",typeString:"struct SetTokenLibrary.SetDetails memory"}},id:17860,isConstant:false,isLValue:true,isPure:false,lValueRequested:false,memberName:"components",nodeType:"MemberAccess",referencedDeclaration:6722,src:"6094:20:78",typeDescriptions:{typeIdentifier:"t_array$_t_address_$dyn_memory",typeString:"address[] memory"}},id:17861,isConstant:false,isLValue:false,isPure:false,lValueRequested:false,memberName:"length",nodeType:"MemberAccess",referencedDeclaration:null,src:"6094:27:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},src:"6090:31:78",typeDescriptions:{typeIdentifier:"t_bool",typeString:"bool"}},id:17903,initializationExpression:{assignments:[17855],declarations:[{constant:false,id:17855,name:"i",nodeType:"VariableDeclaration",scope:17903,src:"6075:9:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"},typeName:{id:17854,name:"uint256",nodeType:"ElementaryTypeName",src:"6075:7:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},value:null,visibility:"internal"}],id:17857,initialValue:{argumentTypes:null,hexValue:"30",id:17856,isConstant:false,isLValue:false,isPure:true,kind:"number",lValueRequested:false,nodeType:"Literal",src:"6087:1:78",subdenomination:null,typeDescriptions:{typeIdentifier:"t_rational_0_by_1",typeString:"int_const 0"},value:"0"},nodeType:"VariableDeclarationStatement",src:"6075:13:78"},loopExpression:{expression:{argumentTypes:null,id:17864,isConstant:false,isLValue:false,isPure:false,lValueRequested:false,nodeType:"UnaryOperation",operator:"++",prefix:false,src:"6123:3:78",subExpression:{argumentTypes:null,id:17863,name:"i",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17855,src:"6123:1:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},id:17865,nodeType:"ExpressionStatement",src:"6123:3:78"},nodeType:"ForStatement",src:"6070:710:78"},{expression:{argumentTypes:null,id:17904,name:"maxIssueAmount",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17843,src:"6797:14:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},functionReturnParameters:17841,id:17905,nodeType:"Return",src:"6790:21:78"}]},documentation:"Get the maximum possible issue amount of nextSet based on number of components owned by rebalancing\nset token.\n     * @param _vaultAddress     Vault address\n@param _setToken         nextSet details\n@return uint256          maxIssueAmount",id:17907,implemented:true,kind:"function",modifiers:[],name:"calculateMaxIssueAmount",nodeType:"FunctionDefinition",parameters:{id:17838,nodeType:"ParameterList",parameters:[{constant:false,id:17835,name:"_vaultAddress",nodeType:"VariableDeclaration",scope:17907,src:"5808:21:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_address",typeString:"address"},typeName:{id:17834,name:"address",nodeType:"ElementaryTypeName",src:"5808:7:78",stateMutability:"nonpayable",typeDescriptions:{typeIdentifier:"t_address",typeString:"address"}},value:null,visibility:"internal"},{constant:false,id:17837,name:"_setToken",nodeType:"VariableDeclaration",scope:17907,src:"5839:43:78",stateVariable:false,storageLocation:"memory",typeDescriptions:{typeIdentifier:"t_struct$_SetDetails_$6726_memory_ptr",typeString:"struct SetTokenLibrary.SetDetails"},typeName:{contractScope:null,id:17836,name:"SetTokenLibrary.SetDetails",nodeType:"UserDefinedTypeName",referencedDeclaration:6726,src:"5839:26:78",typeDescriptions:{typeIdentifier:"t_struct$_SetDetails_$6726_storage_ptr",typeString:"struct SetTokenLibrary.SetDetails"}},value:null,visibility:"internal"}],src:"5798:90:78"},returnParameters:{id:17841,nodeType:"ParameterList",parameters:[{constant:false,id:17840,name:"",nodeType:"VariableDeclaration",scope:17907,src:"5934:7:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"},typeName:{id:17839,name:"uint256",nodeType:"ElementaryTypeName",src:"5934:7:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},value:null,visibility:"internal"}],src:"5933:9:78"},scope:17908,src:"5766:1052:78",stateMutability:"view",superFunction:null,visibility:"public"}],scope:17909,src:"1327:5493:78"}],src:"597:6224:78"},legacyAST:{absolutePath:"/Users/justin_chen/Dropbox/workspace/set-protocol-contracts/contracts/core/tokens/rebalancing-libraries/SettleRebalanceLibrary.sol",exportedSymbols:{SettleRebalanceLibrary:[17908]},id:17909,nodeType:"SourceUnit",nodes:[{id:17677,literals:["solidity","0.5",".7"],nodeType:"PragmaDirective",src:"597:22:78"},{id:17678,literals:["experimental","ABIEncoderV2"],nodeType:"PragmaDirective",src:"620:35:78"},{absolutePath:"openzeppelin-solidity/contracts/math/Math.sol",file:"openzeppelin-solidity/contracts/math/Math.sol",id:17680,nodeType:"ImportDirective",scope:17909,sourceUnit:29513,src:"657:69:78",symbolAliases:[{foreign:17679,local:null}],unitAlias:""},{absolutePath:"openzeppelin-solidity/contracts/math/SafeMath.sol",file:"openzeppelin-solidity/contracts/math/SafeMath.sol",id:17682,nodeType:"ImportDirective",scope:17909,sourceUnit:29641,src:"727:77:78",symbolAliases:[{foreign:17681,local:null}],unitAlias:""},{absolutePath:"/Users/justin_chen/Dropbox/workspace/set-protocol-contracts/contracts/lib/CommonMath.sol",file:"../../../lib/CommonMath.sol",id:17684,nodeType:"ImportDirective",scope:17909,sourceUnit:23437,src:"806:57:78",symbolAliases:[{foreign:17683,local:null}],unitAlias:""},{absolutePath:"/Users/justin_chen/Dropbox/workspace/set-protocol-contracts/contracts/core/interfaces/ICore.sol",file:"../../interfaces/ICore.sol",id:17686,nodeType:"ImportDirective",scope:17909,sourceUnit:4747,src:"864:51:78",symbolAliases:[{foreign:17685,local:null}],unitAlias:""},{absolutePath:"/Users/justin_chen/Dropbox/workspace/set-protocol-contracts/contracts/core/interfaces/IVault.sol",file:"../../interfaces/IVault.sol",id:17688,nodeType:"ImportDirective",scope:17909,sourceUnit:5783,src:"916:53:78",symbolAliases:[{foreign:17687,local:null}],unitAlias:""},{absolutePath:"/Users/justin_chen/Dropbox/workspace/set-protocol-contracts/contracts/core/interfaces/ISetToken.sol",file:"../../interfaces/ISetToken.sol",id:17690,nodeType:"ImportDirective",scope:17909,sourceUnit:5660,src:"970:59:78",symbolAliases:[{foreign:17689,local:null}],unitAlias:""},{absolutePath:"/Users/justin_chen/Dropbox/workspace/set-protocol-contracts/contracts/core/lib/RebalancingLibrary.sol",file:"../../lib/RebalancingLibrary.sol",id:17692,nodeType:"ImportDirective",scope:17909,sourceUnit:6658,src:"1030:70:78",symbolAliases:[{foreign:17691,local:null}],unitAlias:""},{absolutePath:"/Users/justin_chen/Dropbox/workspace/set-protocol-contracts/contracts/core/lib/SetTokenLibrary.sol",file:"../../lib/SetTokenLibrary.sol",id:17694,nodeType:"ImportDirective",scope:17909,sourceUnit:6842,src:"1101:64:78",symbolAliases:[{foreign:17693,local:null}],unitAlias:""},{baseContracts:[],contractDependencies:[],contractKind:"library",documentation:"@title SettleRebalanceLibrary\n@author Set Protocol\n * Default implementation of Rebalancing Set Token settle rebalance and related functions.",fullyImplemented:true,id:17908,linearizedBaseContracts:[17908],name:"SettleRebalanceLibrary",nodeType:"ContractDefinition",nodes:[{id:17697,libraryName:{contractScope:null,id:17695,name:"SafeMath",nodeType:"UserDefinedTypeName",referencedDeclaration:29640,src:"1370:8:78",typeDescriptions:{typeIdentifier:"t_contract$_SafeMath_$29640",typeString:"library SafeMath"}},nodeType:"UsingForDirective",src:"1364:27:78",typeName:{id:17696,name:"uint256",nodeType:"ElementaryTypeName",src:"1383:7:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}}},{body:{id:17770,nodeType:"Block",src:"2494:1125:78",statements:[{expression:{argumentTypes:null,arguments:[{argumentTypes:null,commonType:{typeIdentifier:"t_uint8",typeString:"uint8"},id:17725,isConstant:false,isLValue:false,isPure:false,lValueRequested:false,leftExpression:{argumentTypes:null,id:17719,name:"_rebalanceState",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17713,src:"2582:15:78",typeDescriptions:{typeIdentifier:"t_uint8",typeString:"uint8"}},nodeType:"BinaryOperation",operator:"==",rightExpression:{argumentTypes:null,arguments:[{argumentTypes:null,expression:{argumentTypes:null,expression:{argumentTypes:null,id:17721,name:"RebalancingLibrary",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:6657,src:"2607:18:78",typeDescriptions:{typeIdentifier:"t_type$_t_contract$_RebalancingLibrary_$6657_$",typeString:"type(library RebalancingLibrary)"}},id:17722,isConstant:false,isLValue:false,isPure:false,lValueRequested:false,memberName:"State",nodeType:"MemberAccess",referencedDeclaration:6633,src:"2607:24:78",typeDescriptions:{typeIdentifier:"t_type$_t_enum$_State_$6633_$",typeString:"type(enum RebalancingLibrary.State)"}},id:17723,isConstant:false,isLValue:false,isPure:true,lValueRequested:false,memberName:"Rebalance",nodeType:"MemberAccess",referencedDeclaration:null,src:"2607:34:78",typeDescriptions:{typeIdentifier:"t_enum$_State_$6633",typeString:"enum RebalancingLibrary.State"}}],expression:{argumentTypes:[{typeIdentifier:"t_enum$_State_$6633",typeString:"enum RebalancingLibrary.State"}],id:17720,isConstant:false,isLValue:false,isPure:true,lValueRequested:false,nodeType:"ElementaryTypeNameExpression",src:"2601:5:78",typeDescriptions:{typeIdentifier:"t_type$_t_uint8_$",typeString:"type(uint8)"},typeName:"uint8"},id:17724,isConstant:false,isLValue:false,isPure:true,kind:"typeConversion",lValueRequested:false,names:[],nodeType:"FunctionCall",src:"2601:41:78",typeDescriptions:{typeIdentifier:"t_uint8",typeString:"uint8"}},src:"2582:60:78",typeDescriptions:{typeIdentifier:"t_bool",typeString:"bool"}},{argumentTypes:null,hexValue:"526562616c616e63696e67536574546f6b656e2e736574746c65526562616c616e63653a205374617465206d75737420626520526562616c616e6365",id:17726,isConstant:false,isLValue:false,isPure:true,kind:"string",lValueRequested:false,nodeType:"Literal",src:"2656:62:78",subdenomination:null,typeDescriptions:{typeIdentifier:"t_stringliteral_317be77dcae752c2e504ffbe32fac8453b82dd0ff05c8a7270fa54f560e89120",typeString:'literal_string "RebalancingSetToken.settleRebalance: State must be Rebalance"'},value:"RebalancingSetToken.settleRebalance: State must be Rebalance"}],expression:{argumentTypes:[{typeIdentifier:"t_bool",typeString:"bool"},{typeIdentifier:"t_stringliteral_317be77dcae752c2e504ffbe32fac8453b82dd0ff05c8a7270fa54f560e89120",typeString:'literal_string "RebalancingSetToken.settleRebalance: State must be Rebalance"'}],id:17718,name:"require",nodeType:"Identifier",overloadedDeclarations:[30379,30380],referencedDeclaration:30380,src:"2561:7:78",typeDescriptions:{typeIdentifier:"t_function_require_pure$_t_bool_$_t_string_memory_ptr_$returns$__$",typeString:"function (bool,string memory) pure"}},id:17727,isConstant:false,isLValue:false,isPure:false,kind:"functionCall",lValueRequested:false,names:[],nodeType:"FunctionCall",src:"2561:167:78",typeDescriptions:{typeIdentifier:"t_tuple$__$",typeString:"tuple()"}},id:17728,nodeType:"ExpressionStatement",src:"2561:167:78"},{expression:{argumentTypes:null,arguments:[{argumentTypes:null,commonType:{typeIdentifier:"t_uint256",typeString:"uint256"},id:17732,isConstant:false,isLValue:false,isPure:false,lValueRequested:false,leftExpression:{argumentTypes:null,id:17730,name:"_remainingCurrentSets",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17701,src:"2818:21:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},nodeType:"BinaryOperation",operator:"<",rightExpression:{argumentTypes:null,id:17731,name:"_minimumBid",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17703,src:"2842:11:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},src:"2818:35:78",typeDescriptions:{typeIdentifier:"t_bool",typeString:"bool"}},{argumentTypes:null,hexValue:"526562616c616e63696e67536574546f6b656e2e736574746c65526562616c616e63653a20526562616c616e6365206e6f7420636f6d706c65746564",id:17733,isConstant:false,isLValue:false,isPure:true,kind:"string",lValueRequested:false,nodeType:"Literal",src:"2867:62:78",subdenomination:null,typeDescriptions:{typeIdentifier:"t_stringliteral_0d401484e2b49f5a01e3012eb88fd4ccc19a6e73d6f8b7f18eef6ad7f1008d14",typeString:'literal_string "RebalancingSetToken.settleRebalance: Rebalance not completed"'},value:"RebalancingSetToken.settleRebalance: Rebalance not completed"}],expression:{argumentTypes:[{typeIdentifier:"t_bool",typeString:"bool"},{typeIdentifier:"t_stringliteral_0d401484e2b49f5a01e3012eb88fd4ccc19a6e73d6f8b7f18eef6ad7f1008d14",typeString:'literal_string "RebalancingSetToken.settleRebalance: Rebalance not completed"'}],id:17729,name:"require",nodeType:"Identifier",overloadedDeclarations:[30379,30380],referencedDeclaration:30380,src:"2797:7:78",typeDescriptions:{typeIdentifier:"t_function_require_pure$_t_bool_$_t_string_memory_ptr_$returns$__$",typeString:"function (bool,string memory) pure"}},id:17734,isConstant:false,isLValue:false,isPure:false,kind:"functionCall",lValueRequested:false,names:[],nodeType:"FunctionCall",src:"2797:142:78",typeDescriptions:{typeIdentifier:"t_tuple$__$",typeString:"tuple()"}},id:17735,nodeType:"ExpressionStatement",src:"2797:142:78"},{assignments:[17737],declarations:[{constant:false,id:17737,name:"issueAmount",nodeType:"VariableDeclaration",scope:17770,src:"2991:19:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"},typeName:{id:17736,name:"uint256",nodeType:"ElementaryTypeName",src:"2991:7:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},value:null,visibility:"internal"}],id:17738,initialValue:null,nodeType:"VariableDeclarationStatement",src:"2991:19:78"},{assignments:[17740],declarations:[{constant:false,id:17740,name:"nextUnitShares",nodeType:"VariableDeclaration",scope:17770,src:"3020:22:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"},typeName:{id:17739,name:"uint256",nodeType:"ElementaryTypeName",src:"3020:7:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},value:null,visibility:"internal"}],id:17741,initialValue:null,nodeType:"VariableDeclarationStatement",src:"3020:22:78"},{expression:{argumentTypes:null,id:17751,isConstant:false,isLValue:false,isPure:false,lValueRequested:false,leftHandSide:{argumentTypes:null,components:[{argumentTypes:null,id:17742,name:"issueAmount",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17737,src:"3066:11:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},{argumentTypes:null,id:17743,name:"nextUnitShares",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17740,src:"3091:14:78",
typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}}],id:17744,isConstant:false,isInlineArray:false,isLValue:true,isPure:false,lValueRequested:true,nodeType:"TupleExpression",src:"3052:63:78",typeDescriptions:{typeIdentifier:"t_tuple$_t_uint256_$_t_uint256_$",typeString:"tuple(uint256,uint256)"}},nodeType:"Assignment",operator:"=",rightHandSide:{argumentTypes:null,arguments:[{argumentTypes:null,id:17746,name:"_totalSupply",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17699,src:"3161:12:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},{argumentTypes:null,id:17747,name:"_naturalUnit",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17705,src:"3187:12:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},{argumentTypes:null,id:17748,name:"_nextSet",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17707,src:"3213:8:78",typeDescriptions:{typeIdentifier:"t_address",typeString:"address"}},{argumentTypes:null,id:17749,name:"_vaultAddress",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17711,src:"3235:13:78",typeDescriptions:{typeIdentifier:"t_address",typeString:"address"}}],expression:{argumentTypes:[{typeIdentifier:"t_uint256",typeString:"uint256"},{typeIdentifier:"t_uint256",typeString:"uint256"},{typeIdentifier:"t_address",typeString:"address"},{typeIdentifier:"t_address",typeString:"address"}],id:17745,name:"calculateNextSetIssueQuantity",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17833,src:"3118:29:78",typeDescriptions:{typeIdentifier:"t_function_internal_view$_t_uint256_$_t_uint256_$_t_address_$_t_address_$returns$_t_uint256_$_t_uint256_$",typeString:"function (uint256,uint256,address,address) view returns (uint256,uint256)"}},id:17750,isConstant:false,isLValue:false,isPure:false,kind:"functionCall",lValueRequested:false,names:[],nodeType:"FunctionCall",src:"3118:140:78",typeDescriptions:{typeIdentifier:"t_tuple$_t_uint256_$_t_uint256_$",typeString:"tuple(uint256,uint256)"}},src:"3052:206:78",typeDescriptions:{typeIdentifier:"t_tuple$__$",typeString:"tuple()"}},id:17752,nodeType:"ExpressionStatement",src:"3052:206:78"},{expression:{argumentTypes:null,arguments:[{argumentTypes:null,commonType:{typeIdentifier:"t_uint256",typeString:"uint256"},id:17756,isConstant:false,isLValue:false,isPure:false,lValueRequested:false,leftExpression:{argumentTypes:null,id:17754,name:"nextUnitShares",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17740,src:"3290:14:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},nodeType:"BinaryOperation",operator:">",rightExpression:{argumentTypes:null,hexValue:"30",id:17755,isConstant:false,isLValue:false,isPure:true,kind:"number",lValueRequested:false,nodeType:"Literal",src:"3307:1:78",subdenomination:null,typeDescriptions:{typeIdentifier:"t_rational_0_by_1",typeString:"int_const 0"},value:"0"},src:"3290:18:78",typeDescriptions:{typeIdentifier:"t_bool",typeString:"bool"}},{argumentTypes:null,hexValue:"526562616c616e63696e67536574546f6b656e2e736574746c65526562616c616e63653a204661696c656420726562616c616e63652c20756e697473686172657320657175616c7320302e2043616c6c20656e644661696c656441756374696f6e2e",id:17757,isConstant:false,isLValue:false,isPure:true,kind:"string",lValueRequested:false,nodeType:"Literal",src:"3322:100:78",subdenomination:null,typeDescriptions:{typeIdentifier:"t_stringliteral_2362f766e8e4d46310b53662e15cfa10ffbe720c9a9671204521098799a2cbcc",typeString:'literal_string "RebalancingSetToken.settleRebalance: Failed rebalance, unitshares equals 0. Call endFailedAuction."'},value:"RebalancingSetToken.settleRebalance: Failed rebalance, unitshares equals 0. Call endFailedAuction."}],expression:{argumentTypes:[{typeIdentifier:"t_bool",typeString:"bool"},{typeIdentifier:"t_stringliteral_2362f766e8e4d46310b53662e15cfa10ffbe720c9a9671204521098799a2cbcc",typeString:'literal_string "RebalancingSetToken.settleRebalance: Failed rebalance, unitshares equals 0. Call endFailedAuction."'}],id:17753,name:"require",nodeType:"Identifier",overloadedDeclarations:[30379,30380],referencedDeclaration:30380,src:"3269:7:78",typeDescriptions:{typeIdentifier:"t_function_require_pure$_t_bool_$_t_string_memory_ptr_$returns$__$",typeString:"function (bool,string memory) pure"}},id:17758,isConstant:false,isLValue:false,isPure:false,kind:"functionCall",lValueRequested:false,names:[],nodeType:"FunctionCall",src:"3269:163:78",typeDescriptions:{typeIdentifier:"t_tuple$__$",typeString:"tuple()"}},id:17759,nodeType:"ExpressionStatement",src:"3269:163:78"},{expression:{argumentTypes:null,arguments:[{argumentTypes:null,id:17764,name:"_nextSet",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17707,src:"3537:8:78",typeDescriptions:{typeIdentifier:"t_address",typeString:"address"}},{argumentTypes:null,id:17765,name:"issueAmount",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17737,src:"3559:11:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}}],expression:{argumentTypes:[{typeIdentifier:"t_address",typeString:"address"},{typeIdentifier:"t_uint256",typeString:"uint256"}],expression:{argumentTypes:null,arguments:[{argumentTypes:null,id:17761,name:"_coreAddress",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17709,src:"3497:12:78",typeDescriptions:{typeIdentifier:"t_address",typeString:"address"}}],expression:{argumentTypes:[{typeIdentifier:"t_address",typeString:"address"}],id:17760,name:"ICore",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:4746,src:"3491:5:78",typeDescriptions:{typeIdentifier:"t_type$_t_contract$_ICore_$4746_$",typeString:"type(contract ICore)"}},id:17762,isConstant:false,isLValue:false,isPure:false,kind:"typeConversion",lValueRequested:false,names:[],nodeType:"FunctionCall",src:"3491:19:78",typeDescriptions:{typeIdentifier:"t_contract$_ICore_$4746",typeString:"contract ICore"}},id:17763,isConstant:false,isLValue:false,isPure:false,lValueRequested:false,memberName:"issueInVault",nodeType:"MemberAccess",referencedDeclaration:4520,src:"3491:32:78",typeDescriptions:{typeIdentifier:"t_function_external_nonpayable$_t_address_$_t_uint256_$returns$__$",typeString:"function (address,uint256) external"}},id:17766,isConstant:false,isLValue:false,isPure:false,kind:"functionCall",lValueRequested:false,names:[],nodeType:"FunctionCall",src:"3491:89:78",typeDescriptions:{typeIdentifier:"t_tuple$__$",typeString:"tuple()"}},id:17767,nodeType:"ExpressionStatement",src:"3491:89:78"},{expression:{argumentTypes:null,id:17768,name:"nextUnitShares",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17740,src:"3598:14:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},functionReturnParameters:17717,id:17769,nodeType:"Return",src:"3591:21:78"}]},documentation:"Calculate the amount of nextSets to issue by using the component amounts in the\nvault, new unitShares follow from this calculation\n     * @param   _totalSupply            Total supply of rebalancing set token\n@param   _remainingCurrentSets   Amount of currentSets remaining\n@param   _minimumBid             Minimum bid allowed, used to see if valid settle\n@param   _naturalUnit            Natural unit of rebalancing set token\n@param   _nextSet                Address of next set\n@param   _coreAddress            Core address\n@param   _vaultAddress           Vault address\n@return  uint256                 Amount of nextSets to issue",id:17771,implemented:true,kind:"function",modifiers:[],name:"settleRebalance",nodeType:"FunctionDefinition",parameters:{id:17714,nodeType:"ParameterList",parameters:[{constant:false,id:17699,name:"_totalSupply",nodeType:"VariableDeclaration",scope:17771,src:"2206:20:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"},typeName:{id:17698,name:"uint256",nodeType:"ElementaryTypeName",src:"2206:7:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},value:null,visibility:"internal"},{constant:false,id:17701,name:"_remainingCurrentSets",nodeType:"VariableDeclaration",scope:17771,src:"2236:29:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"},typeName:{id:17700,name:"uint256",nodeType:"ElementaryTypeName",src:"2236:7:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},value:null,visibility:"internal"},{constant:false,id:17703,name:"_minimumBid",nodeType:"VariableDeclaration",scope:17771,src:"2275:19:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"},typeName:{id:17702,name:"uint256",nodeType:"ElementaryTypeName",src:"2275:7:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},value:null,visibility:"internal"},{constant:false,id:17705,name:"_naturalUnit",nodeType:"VariableDeclaration",scope:17771,src:"2304:20:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"},typeName:{id:17704,name:"uint256",nodeType:"ElementaryTypeName",src:"2304:7:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},value:null,visibility:"internal"},{constant:false,id:17707,name:"_nextSet",nodeType:"VariableDeclaration",scope:17771,src:"2334:16:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_address",typeString:"address"},typeName:{id:17706,name:"address",nodeType:"ElementaryTypeName",src:"2334:7:78",stateMutability:"nonpayable",typeDescriptions:{typeIdentifier:"t_address",typeString:"address"}},value:null,visibility:"internal"},{constant:false,id:17709,name:"_coreAddress",nodeType:"VariableDeclaration",scope:17771,src:"2360:20:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_address",typeString:"address"},typeName:{id:17708,name:"address",nodeType:"ElementaryTypeName",src:"2360:7:78",stateMutability:"nonpayable",typeDescriptions:{typeIdentifier:"t_address",typeString:"address"}},value:null,visibility:"internal"},{constant:false,id:17711,name:"_vaultAddress",nodeType:"VariableDeclaration",scope:17771,src:"2390:21:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_address",typeString:"address"},typeName:{id:17710,name:"address",nodeType:"ElementaryTypeName",src:"2390:7:78",stateMutability:"nonpayable",typeDescriptions:{typeIdentifier:"t_address",typeString:"address"}},value:null,visibility:"internal"},{constant:false,id:17713,name:"_rebalanceState",nodeType:"VariableDeclaration",scope:17771,src:"2421:21:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_uint8",typeString:"uint8"},typeName:{id:17712,name:"uint8",nodeType:"ElementaryTypeName",src:"2421:5:78",typeDescriptions:{typeIdentifier:"t_uint8",typeString:"uint8"}},value:null,visibility:"internal"}],src:"2196:252:78"},returnParameters:{id:17717,nodeType:"ParameterList",parameters:[{constant:false,id:17716,name:"",nodeType:"VariableDeclaration",scope:17771,src:"2481:7:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"},typeName:{id:17715,name:"uint256",nodeType:"ElementaryTypeName",src:"2481:7:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},value:null,visibility:"internal"}],src:"2480:9:78"},scope:17908,src:"2172:1447:78",stateMutability:"nonpayable",superFunction:null,visibility:"public"},{body:{id:17832,nodeType:"Block",src:"4419:1052:78",statements:[{assignments:[17789],declarations:[{constant:false,id:17789,name:"nextSetToken",nodeType:"VariableDeclaration",scope:17832,src:"4487:46:78",stateVariable:false,storageLocation:"memory",typeDescriptions:{typeIdentifier:"t_struct$_SetDetails_$6726_memory_ptr",typeString:"struct SetTokenLibrary.SetDetails"},typeName:{contractScope:null,id:17788,name:"SetTokenLibrary.SetDetails",nodeType:"UserDefinedTypeName",referencedDeclaration:6726,src:"4487:26:78",typeDescriptions:{typeIdentifier:"t_struct$_SetDetails_$6726_storage_ptr",typeString:"struct SetTokenLibrary.SetDetails"}},value:null,visibility:"internal"}],id:17794,initialValue:{argumentTypes:null,arguments:[{argumentTypes:null,id:17792,name:"_nextSet",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17777,src:"4566:8:78",typeDescriptions:{typeIdentifier:"t_address",typeString:"address"}}],expression:{argumentTypes:[{typeIdentifier:"t_address",typeString:"address"}],expression:{argumentTypes:null,id:17790,name:"SetTokenLibrary",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:6841,src:"4536:15:78",typeDescriptions:{typeIdentifier:"t_type$_t_contract$_SetTokenLibrary_$6841_$",typeString:"type(library SetTokenLibrary)"}},id:17791,isConstant:false,isLValue:false,isPure:false,lValueRequested:false,memberName:"getSetDetails",nodeType:"MemberAccess",referencedDeclaration:6840,src:"4536:29:78",typeDescriptions:{typeIdentifier:"t_function_internal_view$_t_address_$returns$_t_struct$_SetDetails_$6726_memory_ptr_$",typeString:"function (address) view returns (struct SetTokenLibrary.SetDetails memory)"}},id:17793,isConstant:false,isLValue:false,isPure:false,kind:"functionCall",lValueRequested:false,names:[],nodeType:"FunctionCall",src:"4536:39:78",typeDescriptions:{typeIdentifier:"t_struct$_SetDetails_$6726_memory_ptr",typeString:"struct SetTokenLibrary.SetDetails memory"}},nodeType:"VariableDeclarationStatement",src:"4487:88:78"},{assignments:[17796],declarations:[{constant:false,id:17796,name:"maxIssueAmount",nodeType:"VariableDeclaration",scope:17832,src:"4585:22:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"},typeName:{id:17795,name:"uint256",nodeType:"ElementaryTypeName",src:"4585:7:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},value:null,visibility:"internal"}],id:17801,initialValue:{argumentTypes:null,arguments:[{argumentTypes:null,id:17798,name:"_vaultAddress",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17779,src:"4647:13:78",typeDescriptions:{typeIdentifier:"t_address",typeString:"address"}},{argumentTypes:null,id:17799,name:"nextSetToken",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17789,src:"4674:12:78",typeDescriptions:{typeIdentifier:"t_struct$_SetDetails_$6726_memory_ptr",typeString:"struct SetTokenLibrary.SetDetails memory"}}],expression:{argumentTypes:[{typeIdentifier:"t_address",typeString:"address"},{typeIdentifier:"t_struct$_SetDetails_$6726_memory_ptr",typeString:"struct SetTokenLibrary.SetDetails memory"}],id:17797,name:"calculateMaxIssueAmount",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17907,src:"4610:23:78",typeDescriptions:{typeIdentifier:"t_function_internal_view$_t_address_$_t_struct$_SetDetails_$6726_memory_ptr_$returns$_t_uint256_$",typeString:"function (address,struct SetTokenLibrary.SetDetails memory) view returns (uint256)"}},id:17800,isConstant:false,isLValue:false,isPure:false,kind:"functionCall",lValueRequested:false,names:[],nodeType:"FunctionCall",src:"4610:86:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},nodeType:"VariableDeclarationStatement",src:"4585:111:78"},{assignments:[17803],declarations:[{constant:false,id:17803,name:"naturalUnitsOutstanding",nodeType:"VariableDeclaration",scope:17832,src:"4796:31:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"},typeName:{id:17802,name:"uint256",nodeType:"ElementaryTypeName",src:"4796:7:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},value:null,visibility:"internal"}],id:17808,initialValue:{argumentTypes:null,arguments:[{argumentTypes:null,id:17806,name:"_naturalUnit",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17775,src:"4847:12:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}}],expression:{argumentTypes:[{typeIdentifier:"t_uint256",typeString:"uint256"}],expression:{argumentTypes:null,id:17804,name:"_totalSupply",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17773,src:"4830:12:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},id:17805,isConstant:false,isLValue:false,isPure:false,lValueRequested:false,memberName:"div",nodeType:"MemberAccess",referencedDeclaration:29571,src:"4830:16:78",typeDescriptions:{typeIdentifier:"t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$bound_to$_t_uint256_$",typeString:"function (uint256,uint256) pure returns (uint256)"}},id:17807,isConstant:false,isLValue:false,isPure:false,kind:"functionCall",lValueRequested:false,names:[],nodeType:"FunctionCall",src:"4830:30:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},nodeType:"VariableDeclarationStatement",src:"4796:64:78"},{assignments:[17810],declarations:[{constant:false,id:17810,name:"issueAmount",nodeType:"VariableDeclaration",scope:17832,src:"5164:19:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"},typeName:{id:17809,name:"uint256",nodeType:"ElementaryTypeName",src:"5164:7:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},value:null,visibility:"internal"}],id:17820,initialValue:{argumentTypes:null,arguments:[{argumentTypes:null,expression:{argumentTypes:null,id:17817,name:"nextSetToken",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17789,src:"5235:12:78",typeDescriptions:{typeIdentifier:"t_struct$_SetDetails_$6726_memory_ptr",typeString:"struct SetTokenLibrary.SetDetails memory"}},id:17818,isConstant:false,isLValue:true,isPure:false,lValueRequested:false,memberName:"naturalUnit",nodeType:"MemberAccess",referencedDeclaration:6719,src:"5235:24:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}}],expression:{argumentTypes:[{typeIdentifier:"t_uint256",typeString:"uint256"}],expression:{argumentTypes:null,arguments:[{argumentTypes:null,expression:{argumentTypes:null,id:17813,name:"nextSetToken",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17789,src:"5205:12:78",typeDescriptions:{typeIdentifier:"t_struct$_SetDetails_$6726_memory_ptr",typeString:"struct SetTokenLibrary.SetDetails memory"}},id:17814,isConstant:false,isLValue:true,isPure:false,lValueRequested:false,memberName:"naturalUnit",nodeType:"MemberAccess",referencedDeclaration:6719,src:"5205:24:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}}],expression:{argumentTypes:[{typeIdentifier:"t_uint256",typeString:"uint256"}],expression:{argumentTypes:null,id:17811,name:"maxIssueAmount",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17796,src:"5186:14:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},id:17812,isConstant:false,isLValue:false,isPure:false,lValueRequested:false,memberName:"div",nodeType:"MemberAccess",referencedDeclaration:29571,src:"5186:18:78",typeDescriptions:{typeIdentifier:"t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$bound_to$_t_uint256_$",typeString:"function (uint256,uint256) pure returns (uint256)"}},id:17815,isConstant:false,isLValue:false,isPure:false,kind:"functionCall",lValueRequested:false,names:[],nodeType:"FunctionCall",src:"5186:44:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},id:17816,isConstant:false,isLValue:false,isPure:false,lValueRequested:false,memberName:"mul",nodeType:"MemberAccess",referencedDeclaration:29547,src:"5186:48:78",typeDescriptions:{typeIdentifier:"t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$bound_to$_t_uint256_$",typeString:"function (uint256,uint256) pure returns (uint256)"}},id:17819,isConstant:false,isLValue:false,isPure:false,kind:"functionCall",lValueRequested:false,names:[],nodeType:"FunctionCall",src:"5186:74:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},nodeType:"VariableDeclarationStatement",src:"5164:96:78"},{assignments:[17822],declarations:[{constant:false,id:17822,name:"newUnitShares",nodeType:"VariableDeclaration",scope:17832,src:"5355:21:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"},typeName:{id:17821,name:"uint256",nodeType:"ElementaryTypeName",src:"5355:7:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},value:null,visibility:"internal"}],id:17827,initialValue:{argumentTypes:null,arguments:[{argumentTypes:null,id:17825,name:"naturalUnitsOutstanding",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17803,src:"5395:23:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}}],expression:{argumentTypes:[{typeIdentifier:"t_uint256",typeString:"uint256"}],expression:{argumentTypes:null,id:17823,name:"issueAmount",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17810,src:"5379:11:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},id:17824,isConstant:false,isLValue:false,isPure:false,lValueRequested:false,memberName:"div",nodeType:"MemberAccess",referencedDeclaration:29571,src:"5379:15:78",typeDescriptions:{typeIdentifier:"t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$bound_to$_t_uint256_$",typeString:"function (uint256,uint256) pure returns (uint256)"}},id:17826,isConstant:false,isLValue:false,isPure:false,kind:"functionCall",lValueRequested:false,names:[],nodeType:"FunctionCall",src:"5379:40:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},nodeType:"VariableDeclarationStatement",src:"5355:64:78"},{expression:{argumentTypes:null,components:[{argumentTypes:null,id:17828,name:"issueAmount",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17810,src:"5437:11:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},{argumentTypes:null,id:17829,name:"newUnitShares",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17822,src:"5450:13:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}}],id:17830,isConstant:false,isInlineArray:false,isLValue:false,isPure:false,lValueRequested:false,nodeType:"TupleExpression",src:"5436:28:78",typeDescriptions:{typeIdentifier:"t_tuple$_t_uint256_$_t_uint256_$",typeString:"tuple(uint256,uint256)"}},functionReturnParameters:17785,id:17831,nodeType:"Return",src:"5429:35:78"}]},documentation:"Calculate the amount of nextSets to issue by using the component amounts in the\nvault, unitShares following from this calculation.\n     * @param   _totalSupply        Total supply of rebalancing set token\n@param   _naturalUnit        Natural unit of rebalancing set token\n@param   _nextSet            Address of next set\n@param   _vaultAddress       Vault address\n@return  uint256             Amount of nextSets to issue\n@return  uint256             New unitShares for the rebalancingSetToken",id:17833,implemented:true,kind:"function",modifiers:[],name:"calculateNextSetIssueQuantity",nodeType:"FunctionDefinition",parameters:{id:17780,nodeType:"ParameterList",parameters:[{constant:false,id:17773,name:"_totalSupply",nodeType:"VariableDeclaration",scope:17833,src:"4238:20:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"},typeName:{id:17772,name:"uint256",nodeType:"ElementaryTypeName",src:"4238:7:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},value:null,visibility:"internal"},{constant:false,id:17775,name:"_naturalUnit",nodeType:"VariableDeclaration",scope:17833,src:"4268:20:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"},typeName:{id:17774,name:"uint256",nodeType:"ElementaryTypeName",src:"4268:7:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},value:null,visibility:"internal"},{constant:false,id:17777,name:"_nextSet",nodeType:"VariableDeclaration",scope:17833,src:"4298:16:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_address",typeString:"address"},typeName:{id:17776,name:"address",nodeType:"ElementaryTypeName",src:"4298:7:78",stateMutability:"nonpayable",typeDescriptions:{typeIdentifier:"t_address",typeString:"address"}},value:null,visibility:"internal"},{constant:false,id:17779,name:"_vaultAddress",nodeType:"VariableDeclaration",scope:17833,src:"4324:21:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_address",typeString:"address"},typeName:{id:17778,name:"address",nodeType:"ElementaryTypeName",src:"4324:7:78",stateMutability:"nonpayable",typeDescriptions:{typeIdentifier:"t_address",typeString:"address"}},value:null,visibility:"internal"}],src:"4228:123:78"},returnParameters:{id:17785,nodeType:"ParameterList",parameters:[{constant:false,id:17782,name:"",nodeType:"VariableDeclaration",scope:17833,src:"4397:7:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"},typeName:{id:17781,name:"uint256",nodeType:"ElementaryTypeName",src:"4397:7:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},value:null,visibility:"internal"},{constant:false,id:17784,name:"",nodeType:"VariableDeclaration",scope:17833,src:"4406:7:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"},typeName:{id:17783,name:"uint256",nodeType:"ElementaryTypeName",src:"4406:7:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},value:null,visibility:"internal"}],src:"4396:18:78"},scope:17908,src:"4190:1281:78",stateMutability:"view",superFunction:null,visibility:"public"},{body:{id:17906,nodeType:"Block",src:"5947:871:78",statements:[{assignments:[17843],declarations:[{constant:false,id:17843,name:"maxIssueAmount",nodeType:"VariableDeclaration",scope:17906,src:"5957:22:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"},typeName:{id:17842,name:"uint256",nodeType:"ElementaryTypeName",src:"5957:7:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},value:null,visibility:"internal"}],id:17847,initialValue:{argumentTypes:null,arguments:[],expression:{argumentTypes:[],expression:{argumentTypes:null,id:17844,name:"CommonMath",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:23436,src:"5982:10:78",typeDescriptions:{typeIdentifier:"t_type$_t_contract$_CommonMath_$23436_$",typeString:"type(library CommonMath)"}},id:17845,isConstant:false,isLValue:false,isPure:false,lValueRequested:false,memberName:"maxUInt256",nodeType:"MemberAccess",referencedDeclaration:23132,src:"5982:21:78",typeDescriptions:{typeIdentifier:"t_function_internal_pure$__$returns$_t_uint256_$",typeString:"function () pure returns (uint256)"}},id:17846,isConstant:false,isLValue:false,isPure:false,kind:"functionCall",lValueRequested:false,names:[],nodeType:"FunctionCall",src:"5982:23:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},nodeType:"VariableDeclarationStatement",src:"5957:48:78"},{assignments:[17849],declarations:[{constant:false,id:17849,name:"vaultInstance",nodeType:"VariableDeclaration",scope:17906,src:"6015:20:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_contract$_IVault_$5782",typeString:"contract IVault"},typeName:{contractScope:null,id:17848,name:"IVault",nodeType:"UserDefinedTypeName",referencedDeclaration:5782,src:"6015:6:78",typeDescriptions:{typeIdentifier:"t_contract$_IVault_$5782",typeString:"contract IVault"}},value:null,visibility:"internal"}],id:17853,initialValue:{argumentTypes:null,arguments:[{argumentTypes:null,id:17851,name:"_vaultAddress",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17835,src:"6045:13:78",typeDescriptions:{typeIdentifier:"t_address",typeString:"address"}}],expression:{argumentTypes:[{typeIdentifier:"t_address",typeString:"address"}],id:17850,name:"IVault",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:5782,src:"6038:6:78",typeDescriptions:{typeIdentifier:"t_type$_t_contract$_IVault_$5782_$",typeString:"type(contract IVault)"}},id:17852,isConstant:false,isLValue:false,isPure:false,kind:"typeConversion",lValueRequested:false,names:[],nodeType:"FunctionCall",src:"6038:21:78",typeDescriptions:{typeIdentifier:"t_contract$_IVault_$5782",typeString:"contract IVault"}},nodeType:"VariableDeclarationStatement",src:"6015:44:78"},{body:{id:17902,nodeType:"Block",src:"6128:652:78",statements:[{assignments:[17867],declarations:[{constant:false,id:17867,name:"componentAmount",nodeType:"VariableDeclaration",scope:17902,src:"6220:23:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"},typeName:{id:17866,name:"uint256",nodeType:"ElementaryTypeName",src:"6220:7:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},value:null,visibility:"internal"}],id:17878,initialValue:{argumentTypes:null,arguments:[{argumentTypes:null,baseExpression:{argumentTypes:null,expression:{argumentTypes:null,id:17870,name:"_setToken",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17837,src:"6293:9:78",typeDescriptions:{typeIdentifier:"t_struct$_SetDetails_$6726_memory_ptr",typeString:"struct SetTokenLibrary.SetDetails memory"}},id:17871,isConstant:false,isLValue:true,isPure:false,lValueRequested:false,memberName:"components",nodeType:"MemberAccess",referencedDeclaration:6722,src:"6293:20:78",typeDescriptions:{typeIdentifier:"t_array$_t_address_$dyn_memory",typeString:"address[] memory"}},id:17873,indexExpression:{argumentTypes:null,id:17872,name:"i",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17855,src:"6314:1:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},isConstant:false,isLValue:true,isPure:false,lValueRequested:false,nodeType:"IndexAccess",src:"6293:23:78",typeDescriptions:{typeIdentifier:"t_address",typeString:"address"}},{argumentTypes:null,arguments:[{argumentTypes:null,id:17875,name:"this",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:30590,src:"6342:4:78",typeDescriptions:{typeIdentifier:"t_contract$_SettleRebalanceLibrary_$17908",typeString:"library SettleRebalanceLibrary"}}],expression:{argumentTypes:[{typeIdentifier:"t_contract$_SettleRebalanceLibrary_$17908",typeString:"library SettleRebalanceLibrary"}],id:17874,isConstant:false,isLValue:false,isPure:true,lValueRequested:false,nodeType:"ElementaryTypeNameExpression",src:"6334:7:78",typeDescriptions:{typeIdentifier:"t_type$_t_address_$",typeString:"type(address)"},typeName:"address"},id:17876,isConstant:false,isLValue:false,isPure:false,kind:"typeConversion",lValueRequested:false,names:[],nodeType:"FunctionCall",src:"6334:13:78",typeDescriptions:{typeIdentifier:"t_address",typeString:"address"}}],expression:{argumentTypes:[{typeIdentifier:"t_address",typeString:"address"},{typeIdentifier:"t_address",typeString:"address"}],expression:{argumentTypes:null,id:17868,name:"vaultInstance",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17849,src:"6246:13:78",typeDescriptions:{typeIdentifier:"t_contract$_IVault_$5782",typeString:"contract IVault"}},id:17869,isConstant:false,isLValue:false,isPure:false,lValueRequested:false,memberName:"getOwnerBalance",nodeType:"MemberAccess",referencedDeclaration:5781,src:"6246:29:78",typeDescriptions:{typeIdentifier:"t_function_external_view$_t_address_$_t_address_$returns$_t_uint256_$",typeString:"function (address,address) view external returns (uint256)"}},id:17877,isConstant:false,isLValue:false,isPure:false,kind:"functionCall",
lValueRequested:false,names:[],nodeType:"FunctionCall",src:"6246:115:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},nodeType:"VariableDeclarationStatement",src:"6220:141:78"},{assignments:[17880],declarations:[{constant:false,id:17880,name:"componentIssueAmount",nodeType:"VariableDeclaration",scope:17902,src:"6546:28:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"},typeName:{id:17879,name:"uint256",nodeType:"ElementaryTypeName",src:"6546:7:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},value:null,visibility:"internal"}],id:17892,initialValue:{argumentTypes:null,arguments:[{argumentTypes:null,expression:{argumentTypes:null,id:17889,name:"_setToken",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17837,src:"6621:9:78",typeDescriptions:{typeIdentifier:"t_struct$_SetDetails_$6726_memory_ptr",typeString:"struct SetTokenLibrary.SetDetails memory"}},id:17890,isConstant:false,isLValue:true,isPure:false,lValueRequested:false,memberName:"naturalUnit",nodeType:"MemberAccess",referencedDeclaration:6719,src:"6621:21:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}}],expression:{argumentTypes:[{typeIdentifier:"t_uint256",typeString:"uint256"}],expression:{argumentTypes:null,arguments:[{argumentTypes:null,baseExpression:{argumentTypes:null,expression:{argumentTypes:null,id:17883,name:"_setToken",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17837,src:"6597:9:78",typeDescriptions:{typeIdentifier:"t_struct$_SetDetails_$6726_memory_ptr",typeString:"struct SetTokenLibrary.SetDetails memory"}},id:17884,isConstant:false,isLValue:true,isPure:false,lValueRequested:false,memberName:"units",nodeType:"MemberAccess",referencedDeclaration:6725,src:"6597:15:78",typeDescriptions:{typeIdentifier:"t_array$_t_uint256_$dyn_memory",typeString:"uint256[] memory"}},id:17886,indexExpression:{argumentTypes:null,id:17885,name:"i",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17855,src:"6613:1:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},isConstant:false,isLValue:true,isPure:false,lValueRequested:false,nodeType:"IndexAccess",src:"6597:18:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}}],expression:{argumentTypes:[{typeIdentifier:"t_uint256",typeString:"uint256"}],expression:{argumentTypes:null,id:17881,name:"componentAmount",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17867,src:"6577:15:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},id:17882,isConstant:false,isLValue:false,isPure:false,lValueRequested:false,memberName:"div",nodeType:"MemberAccess",referencedDeclaration:29571,src:"6577:19:78",typeDescriptions:{typeIdentifier:"t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$bound_to$_t_uint256_$",typeString:"function (uint256,uint256) pure returns (uint256)"}},id:17887,isConstant:false,isLValue:false,isPure:false,kind:"functionCall",lValueRequested:false,names:[],nodeType:"FunctionCall",src:"6577:39:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},id:17888,isConstant:false,isLValue:false,isPure:false,lValueRequested:false,memberName:"mul",nodeType:"MemberAccess",referencedDeclaration:29547,src:"6577:43:78",typeDescriptions:{typeIdentifier:"t_function_internal_pure$_t_uint256_$_t_uint256_$returns$_t_uint256_$bound_to$_t_uint256_$",typeString:"function (uint256,uint256) pure returns (uint256)"}},id:17891,isConstant:false,isLValue:false,isPure:false,kind:"functionCall",lValueRequested:false,names:[],nodeType:"FunctionCall",src:"6577:66:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},nodeType:"VariableDeclarationStatement",src:"6546:97:78"},{condition:{argumentTypes:null,commonType:{typeIdentifier:"t_uint256",typeString:"uint256"},id:17895,isConstant:false,isLValue:false,isPure:false,lValueRequested:false,leftExpression:{argumentTypes:null,id:17893,name:"componentIssueAmount",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17880,src:"6661:20:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},nodeType:"BinaryOperation",operator:"<",rightExpression:{argumentTypes:null,id:17894,name:"maxIssueAmount",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17843,src:"6684:14:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},src:"6661:37:78",typeDescriptions:{typeIdentifier:"t_bool",typeString:"bool"}},falseBody:null,id:17901,nodeType:"IfStatement",src:"6657:113:78",trueBody:{id:17900,nodeType:"Block",src:"6700:70:78",statements:[{expression:{argumentTypes:null,id:17898,isConstant:false,isLValue:false,isPure:false,lValueRequested:false,leftHandSide:{argumentTypes:null,id:17896,name:"maxIssueAmount",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17843,src:"6718:14:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},nodeType:"Assignment",operator:"=",rightHandSide:{argumentTypes:null,id:17897,name:"componentIssueAmount",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17880,src:"6735:20:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},src:"6718:37:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},id:17899,nodeType:"ExpressionStatement",src:"6718:37:78"}]}}]},condition:{argumentTypes:null,commonType:{typeIdentifier:"t_uint256",typeString:"uint256"},id:17862,isConstant:false,isLValue:false,isPure:false,lValueRequested:false,leftExpression:{argumentTypes:null,id:17858,name:"i",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17855,src:"6090:1:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},nodeType:"BinaryOperation",operator:"<",rightExpression:{argumentTypes:null,expression:{argumentTypes:null,expression:{argumentTypes:null,id:17859,name:"_setToken",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17837,src:"6094:9:78",typeDescriptions:{typeIdentifier:"t_struct$_SetDetails_$6726_memory_ptr",typeString:"struct SetTokenLibrary.SetDetails memory"}},id:17860,isConstant:false,isLValue:true,isPure:false,lValueRequested:false,memberName:"components",nodeType:"MemberAccess",referencedDeclaration:6722,src:"6094:20:78",typeDescriptions:{typeIdentifier:"t_array$_t_address_$dyn_memory",typeString:"address[] memory"}},id:17861,isConstant:false,isLValue:false,isPure:false,lValueRequested:false,memberName:"length",nodeType:"MemberAccess",referencedDeclaration:null,src:"6094:27:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},src:"6090:31:78",typeDescriptions:{typeIdentifier:"t_bool",typeString:"bool"}},id:17903,initializationExpression:{assignments:[17855],declarations:[{constant:false,id:17855,name:"i",nodeType:"VariableDeclaration",scope:17903,src:"6075:9:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"},typeName:{id:17854,name:"uint256",nodeType:"ElementaryTypeName",src:"6075:7:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},value:null,visibility:"internal"}],id:17857,initialValue:{argumentTypes:null,hexValue:"30",id:17856,isConstant:false,isLValue:false,isPure:true,kind:"number",lValueRequested:false,nodeType:"Literal",src:"6087:1:78",subdenomination:null,typeDescriptions:{typeIdentifier:"t_rational_0_by_1",typeString:"int_const 0"},value:"0"},nodeType:"VariableDeclarationStatement",src:"6075:13:78"},loopExpression:{expression:{argumentTypes:null,id:17864,isConstant:false,isLValue:false,isPure:false,lValueRequested:false,nodeType:"UnaryOperation",operator:"++",prefix:false,src:"6123:3:78",subExpression:{argumentTypes:null,id:17863,name:"i",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17855,src:"6123:1:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},id:17865,nodeType:"ExpressionStatement",src:"6123:3:78"},nodeType:"ForStatement",src:"6070:710:78"},{expression:{argumentTypes:null,id:17904,name:"maxIssueAmount",nodeType:"Identifier",overloadedDeclarations:[],referencedDeclaration:17843,src:"6797:14:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},functionReturnParameters:17841,id:17905,nodeType:"Return",src:"6790:21:78"}]},documentation:"Get the maximum possible issue amount of nextSet based on number of components owned by rebalancing\nset token.\n     * @param _vaultAddress     Vault address\n@param _setToken         nextSet details\n@return uint256          maxIssueAmount",id:17907,implemented:true,kind:"function",modifiers:[],name:"calculateMaxIssueAmount",nodeType:"FunctionDefinition",parameters:{id:17838,nodeType:"ParameterList",parameters:[{constant:false,id:17835,name:"_vaultAddress",nodeType:"VariableDeclaration",scope:17907,src:"5808:21:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_address",typeString:"address"},typeName:{id:17834,name:"address",nodeType:"ElementaryTypeName",src:"5808:7:78",stateMutability:"nonpayable",typeDescriptions:{typeIdentifier:"t_address",typeString:"address"}},value:null,visibility:"internal"},{constant:false,id:17837,name:"_setToken",nodeType:"VariableDeclaration",scope:17907,src:"5839:43:78",stateVariable:false,storageLocation:"memory",typeDescriptions:{typeIdentifier:"t_struct$_SetDetails_$6726_memory_ptr",typeString:"struct SetTokenLibrary.SetDetails"},typeName:{contractScope:null,id:17836,name:"SetTokenLibrary.SetDetails",nodeType:"UserDefinedTypeName",referencedDeclaration:6726,src:"5839:26:78",typeDescriptions:{typeIdentifier:"t_struct$_SetDetails_$6726_storage_ptr",typeString:"struct SetTokenLibrary.SetDetails"}},value:null,visibility:"internal"}],src:"5798:90:78"},returnParameters:{id:17841,nodeType:"ParameterList",parameters:[{constant:false,id:17840,name:"",nodeType:"VariableDeclaration",scope:17907,src:"5934:7:78",stateVariable:false,storageLocation:"default",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"},typeName:{id:17839,name:"uint256",nodeType:"ElementaryTypeName",src:"5934:7:78",typeDescriptions:{typeIdentifier:"t_uint256",typeString:"uint256"}},value:null,visibility:"internal"}],src:"5933:9:78"},scope:17908,src:"5766:1052:78",stateMutability:"view",superFunction:null,visibility:"public"}],scope:17909,src:"1327:5493:78"}],src:"597:6224:78"},compiler:{name:"solc",version:"0.5.7+commit.6da8b019.Linux.g++"},networks:{},schemaVersion:"3.0.23",updatedAt:"2020-04-07T04:29:24.678Z",devdoc:{author:"Set Protocol * Default implementation of Rebalancing Set Token settle rebalance and related functions.",methods:{"calculateMaxIssueAmount(address,SetTokenLibrary.SetDetails)":{params:{_setToken:"nextSet details",_vaultAddress:"Vault address"},"return":"uint256          maxIssueAmount"},"calculateNextSetIssueQuantity(uint256,uint256,address,address)":{params:{_naturalUnit:"Natural unit of rebalancing set token",_nextSet:"Address of next set",_totalSupply:"Total supply of rebalancing set token",_vaultAddress:"Vault address"},"return":"uint256             Amount of nextSets to issueuint256             New unitShares for the rebalancingSetToken"},"settleRebalance(uint256,uint256,uint256,uint256,address,address,address,uint8)":{params:{_coreAddress:"Core address",_minimumBid:"Minimum bid allowed, used to see if valid settle",_naturalUnit:"Natural unit of rebalancing set token",_nextSet:"Address of next set",_remainingCurrentSets:"Amount of currentSets remaining",_totalSupply:"Total supply of rebalancing set token",_vaultAddress:"Vault address"},"return":"uint256                 Amount of nextSets to issue"}},title:"SettleRebalanceLibrary"},userdoc:{methods:{"calculateMaxIssueAmount(address,SetTokenLibrary.SetDetails)":{notice:"Get the maximum possible issue amount of nextSet based on number of components owned by rebalancing set token."},"calculateNextSetIssueQuantity(uint256,uint256,address,address)":{notice:"Calculate the amount of nextSets to issue by using the component amounts in the vault, unitShares following from this calculation."},"settleRebalance(uint256,uint256,uint256,uint256,address,address,address,uint8)":{notice:"Calculate the amount of nextSets to issue by using the component amounts in the vault, new unitShares follow from this calculation"}}}};