"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.TWAPAuction={contractName:"TWAPAuction",abi:[{constant:true,inputs:[],name:"auctionPeriod",outputs:[{name:"",type:"uint256"}],payable:false,stateMutability:"view",type:"function"},{constant:true,inputs:[],name:"expectedChunkAuctionLength",outputs:[{name:"",type:"uint256"}],payable:false,stateMutability:"view",type:"function"},{constant:true,inputs:[],name:"AUCTION_COMPLETION_BUFFER",outputs:[{name:"",type:"uint256"}],payable:false,stateMutability:"view",type:"function"},{constant:true,inputs:[],name:"rangeEnd",outputs:[{name:"",type:"uint256"}],payable:false,stateMutability:"view",type:"function"},{constant:true,inputs:[],name:"rangeStart",outputs:[{name:"",type:"uint256"}],payable:false,stateMutability:"view",type:"function"},{constant:true,inputs:[],name:"oracleWhiteList",outputs:[{name:"",type:"address"}],payable:false,stateMutability:"view",type:"function"},{constant:true,inputs:[{name:"",type:"bytes32"}],name:"chunkSizeWhiteList",outputs:[{name:"min",type:"uint256"},{name:"max",type:"uint256"}],payable:false,stateMutability:"view",type:"function"},{inputs:[{name:"_oracleWhiteList",type:"address"},{name:"_auctionPeriod",type:"uint256"},{name:"_rangeStart",type:"uint256"},{name:"_rangeEnd",type:"uint256"},{name:"_assetPairHashes",type:"bytes32[]"},{components:[{name:"min",type:"uint256"},{name:"max",type:"uint256"}],name:"_assetPairBounds",type:"tuple[]"}],payable:false,stateMutability:"nonpayable",type:"constructor"}],metadata:'{"compiler":{"version":"0.5.7+commit.6da8b019"},"language":"Solidity","output":{"abi":[{"constant":true,"inputs":[],"name":"auctionPeriod","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"expectedChunkAuctionLength","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"AUCTION_COMPLETION_BUFFER","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"rangeEnd","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"rangeStart","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"oracleWhiteList","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"bytes32"}],"name":"chunkSizeWhiteList","outputs":[{"name":"min","type":"uint256"},{"name":"max","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[{"name":"_oracleWhiteList","type":"address"},{"name":"_auctionPeriod","type":"uint256"},{"name":"_rangeStart","type":"uint256"},{"name":"_rangeEnd","type":"uint256"},{"name":"_assetPairHashes","type":"bytes32[]"},{"components":[{"name":"min","type":"uint256"},{"name":"max","type":"uint256"}],"name":"_assetPairBounds","type":"tuple[]"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"}],"devdoc":{"author":"Set Protocol * Contract for executing TWAP Auctions fropm initializing to moving to the next chunk auction. Inherits from TwoAssetPriceBoundedLinearAuction","methods":{"constructor":{"params":{"_assetPairBounds":"List of chunk size bounds for each asset pair","_assetPairHashes":"List of identifying hashes of asset pairs","_auctionPeriod":"Length of auction in seconds","_oracleWhiteList":"OracleWhiteList used by liquidator","_rangeEnd":"Percentage above FairValue to end auction at","_rangeStart":"Percentage below FairValue to begin auction at"}}},"title":"TWAPAuction"},"userdoc":{"methods":{"constructor":"TWAPAuction constructor"}}},"settings":{"compilationTarget":{"/Users/brianweickmann/Documents/Source/set-protocol-contracts/contracts/core/liquidators/twap-impl/TWAPAuction.sol":"TWAPAuction"},"evmVersion":"byzantium","libraries":{},"optimizer":{"enabled":true,"runs":200},"remappings":[]},"sources":{"/Users/brianweickmann/Documents/Source/set-protocol-contracts/contracts/core/interfaces/ICore.sol":{"keccak256":"0x5dc3db4398630ea52d2a40c9ddfa89d94e65c2770a12bab4d2a5c8eb573fb0a0","urls":["bzzr://25e90b53f61b388e0950b808e2296f82d427b66cfd6021212713436b2a592e31"]},"/Users/brianweickmann/Documents/Source/set-protocol-contracts/contracts/core/interfaces/IFeeCalculator.sol":{"keccak256":"0xfdce9b333367bfed8f379738b0eabfe4be0045db735e9f24493de09729593d4d","urls":["bzzr://d2fa7438b492f4f08009810e3e9a2e2c22a429c307562e3f5274d4bfe2d21734"]},"/Users/brianweickmann/Documents/Source/set-protocol-contracts/contracts/core/interfaces/ILiquidator.sol":{"keccak256":"0x9d1e66d56cd51d14787cce5ff8fb378eb6a0bb704e7102d7c4eda5de7f585af3","urls":["bzzr://c44220025ac21fda1dda68e236572c5c4f82bf53ccf504a020487b8c746c7b26"]},"/Users/brianweickmann/Documents/Source/set-protocol-contracts/contracts/core/interfaces/IOracleWhiteList.sol":{"keccak256":"0xc4623b7082c6e017d1f820a05289a71d4262c01444ff1571e92f64a4e82662af","urls":["bzzr://c11cc5b2b50c5e708a09b10adf350e9ea3d3427cc2f199516db4ae9be498aaac"]},"/Users/brianweickmann/Documents/Source/set-protocol-contracts/contracts/core/interfaces/IRebalancingSetToken.sol":{"keccak256":"0xe7356a7b0f0cc95d9526395d776f523a48fd65618730d67b4f31f20ffbd380da","urls":["bzzr://605a33a818eff7ce3370f25fccb751f61c066b4db0772605a2215d1357d68072"]},"/Users/brianweickmann/Documents/Source/set-protocol-contracts/contracts/core/interfaces/IRebalancingSetTokenV2.sol":{"keccak256":"0x46c9dc7c09957eaa4f896b33d8d25ff5268e710172330f033379eed62a052ace","urls":["bzzr://c5b5cdc4e58c0905a03ef70954ac23eefe4776c243049f37e7b93cd8277bb7cb"]},"/Users/brianweickmann/Documents/Source/set-protocol-contracts/contracts/core/interfaces/IRebalancingSetTokenV3.sol":{"keccak256":"0x72164f9d5fcd4d7b03f41df855fde0e079dba4ca743765af8d644e036214f6ae","urls":["bzzr://b3ca58753e49c659bdab71963effffd8f1aff0788cf39e91e02323a6682c4711"]},"/Users/brianweickmann/Documents/Source/set-protocol-contracts/contracts/core/interfaces/ISetToken.sol":{"keccak256":"0xfa6c0c07f8394d89b6b8f72e15778f8452a9341acb20cebb8421f3522aaca1bd","urls":["bzzr://ccf23bb78fd507bf8cbf5cf7ac2a660a1463b87a3689196e42b8f6862d1a6b11"]},"/Users/brianweickmann/Documents/Source/set-protocol-contracts/contracts/core/lib/Rebalance.sol":{"keccak256":"0x74ffa689d93ced6c6e0377a35ec1274241b6191b5aaac5576ada379ac3840286","urls":["bzzr://25bdda3f1f5adfa2c83c760c44993d250cd2df037360f0018d22d268df79e887"]},"/Users/brianweickmann/Documents/Source/set-protocol-contracts/contracts/core/lib/RebalancingLibrary.sol":{"keccak256":"0x7f9dd2f95b2ee71a98b94cb9b0df15874aa134e7480d04a1fcf36aff166a55f4","urls":["bzzr://f43a5563ec5df095151eee30cf7a0941b5a971917c27c7b34d9586b36563ab5b"]},"/Users/brianweickmann/Documents/Source/set-protocol-contracts/contracts/core/lib/SetMath.sol":{"keccak256":"0x4c6762ad3d11c03889df48cc3b26bd199f958deffa651ec30655cd1654a47303","urls":["bzzr://b8e968dd2840d9586babe7852589abff3972135fff299285eaafd31687ae4385"]},"/Users/brianweickmann/Documents/Source/set-protocol-contracts/contracts/core/liquidators/impl/Auction.sol":{"keccak256":"0x5024075a30ac3bb5de365cbc60c1d99b8776c43cfed53418d31a2c10959d5993","urls":["bzzr://b1564c7843aba02566623d350eb2a987d9b5f757a2564dee39762565e2eb5292"]},"/Users/brianweickmann/Documents/Source/set-protocol-contracts/contracts/core/liquidators/impl/LinearAuction.sol":{"keccak256":"0x253367c7f2e8870399fcc3c833bf98dc6d6111698418747d9a6b595673917624","urls":["bzzr://b53d7a1098f20a399280bc49355d67613439bc2418e701b5390015aa8e97f0d5"]},"/Users/brianweickmann/Documents/Source/set-protocol-contracts/contracts/core/liquidators/impl/SetUSDValuation.sol":{"keccak256":"0xb0b518c3a5f80e3f08df8157fb4dda48e1d48d2fa1c7149ee2e52bd21b1e8916","urls":["bzzr://b36893ff192fe43a9ed50161f5b616ed63b9fdeeb0b50b8512f19a84306380e0"]},"/Users/brianweickmann/Documents/Source/set-protocol-contracts/contracts/core/liquidators/impl/TwoAssetPriceBoundedLinearAuction.sol":{"keccak256":"0xffa0ab726149913e8e3f876acb40153a7ac5b553a1208d41506399ae527c2c83","urls":["bzzr://429b5aa0cca9a3781c664cc86f12238cbfd03e9c38b86b59929f94de04bacbc3"]},"/Users/brianweickmann/Documents/Source/set-protocol-contracts/contracts/core/liquidators/twap-impl/TWAPAuction.sol":{"keccak256":"0xe950c111625c6e1fe04f0a6b78887c778243995ab3d0337de213e84b40474e4d","urls":["bzzr://cee37a703dbcf4626d94ad7da4c211e8e618d6ebd1787a9b2320529ca1815453"]},"/Users/brianweickmann/Documents/Source/set-protocol-contracts/contracts/core/liquidators/utils/LiquidatorUtils.sol":{"keccak256":"0x6d0490b5df5842015e56abbc22e2be72c9e3254962c05088dd42063ae3c5fe41","urls":["bzzr://589ef6c305bd961a75ef7a5afa23e83e87e18402f738f1e43320e38dfdbd54de"]},"openzeppelin-solidity/contracts/math/Math.sol":{"keccak256":"0x775160984ceb0931bf67e718fb23afd6fc2a5d38a6e2378ebb438a039ed2269e","urls":["bzzr://209e27ad1c13e3e9b157915e0269ee4c3b6f0a494660dcc4acf1faf102e1a7ad"]},"openzeppelin-solidity/contracts/math/SafeMath.sol":{"keccak256":"0xc2a200a877c4a9b2475c246c54ffecc69ffde3e11af83319c63c2dc5458bac80","urls":["bzzr://c8876e2c39b60f155d748d71d715c8f3903fae5a405ac599adcb6ad2f9a583f9"]},"openzeppelin-solidity/contracts/token/ERC20/ERC20Detailed.sol":{"keccak256":"0xa60f7f7ce98ca2d75c8e02da982d3fe91176269fdab2589bbbb7cc65f2d7c9d3","urls":["bzzr://5edd2c9be304a1e8ed055e243daba5345f242008164f9a0565c33197b860323b"]},"openzeppelin-solidity/contracts/token/ERC20/IERC20.sol":{"keccak256":"0x59e7df16169a498cb8837963b2f5461d88e63bd1eb6c7d58b814d76b84ccbe61","urls":["bzzr://e572c9c4e02e37349702451bf3b5dcbbc86a19da5a51695b5b3e1bfe1e7825dc"]},"set-protocol-contract-utils/contracts/lib/AddressArrayUtils.sol":{"keccak256":"0xb716eab4e8c5a336a2f19078928530829af097912bd1b925644f914b63601f08","urls":["bzzr://d8a21d39779beb316adb5180d08dcba1941eeccd9412ff08feb21a631c18c269"]},"set-protocol-contract-utils/contracts/lib/BoundsLibrary.sol":{"keccak256":"0xc7d55552e939f9d1bc6e123f7f78ff011dc5697c02256751040e746f74f60699","urls":["bzzr://ad5ce8135914d9bb89c2affac2b19d9779edc6c509ed8291461717b71ce45f54"]},"set-protocol-contract-utils/contracts/lib/CommonMath.sol":{"keccak256":"0x3d1d08c6efc2a973fe2c02ddcb02fd99a8c8eb75f74dcbd93e8e15864eee2b6b","urls":["bzzr://580815dd1cf648a4521d923e59087de21143d9c48115ab71579a1f5a8f3d36af"]},"set-protocol-oracles/contracts/meta-oracles/interfaces/IOracle.sol":{"keccak256":"0xeb5a447a0b1ef47547ce12a91b72412880edb9690aa9bcd8746fc3a379f2fbe9","urls":["bzzr://261675b916b84f58bea71ec28c4f711291053174ddf47e860c26daaee506744a"]}},"version":1}',bytecode:"0x608060405234801561001057600080fd5b5060405161089338038061089383398101806040526100329190810190610396565b600085905560018054600160a060020a031916600160a060020a0388161790556002849055600383905580518251146100a0576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016100979061053f565b60405180910390fd5b60005b8251811015610163576100db8282815181106100bb57fe5b60200260200101516101cf64010000000002610220176401000000009004565b610111576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016100979061052f565b81818151811061011d57fe5b60200260200101516004600085848151811061013557fe5b60209081029190910181015182528181019290925260400160002082518155910151600191820155016100a3565b506101c061017e858564010000000061022c6101db82021704565b6101ad61019987600264010000000061022c6101db82021704565b889064010000000061023e6101f682021704565b9064010000000061026561021d82021704565b600555506105c3945050505050565b80516020909101511190565b6000828201838110156101ed57600080fd5b90505b92915050565b600082610205575060006101f0565b8282028284828161021257fe5b04146101ed57600080fd5b600080821161022b57600080fd5b600082848161023657fe5b04949350505050565b600082601f83011261025057600080fd5b815161026361025e82610575565b61054f565b9150818183526020840193506020810190508385602084028201111561028857600080fd5b60005b838110156102b4578161029e8882610330565b845250602092830192919091019060010161028b565b5050505092915050565b600082601f8301126102cf57600080fd5b81516102dd61025e82610575565b9150818183526020840193506020810190508385604084028201111561030257600080fd5b60005b838110156102b45781610318888261034f565b84525060209092019160409190910190600101610305565b600061033c82516105a9565b9392505050565b600061033c82516105ac565b60006040828403121561036157600080fd5b61036b604061054f565b905060006103798484610330565b825250602061038a84848301610330565b60208301525092915050565b60008060008060008060c087890312156103af57600080fd5b60006103bb8989610343565b96505060206103cc89828a01610330565b95505060406103dd89828a01610330565b94505060606103ee89828a01610330565b93505060808701516001604060020a0381111561040a57600080fd5b61041689828a0161023f565b92505060a08701516001604060020a0381111561043257600080fd5b61043e89828a016102be565b9150509295509295509295565b6000610458603e83610595565b7f5457415041756374696f6e2e636f6e7374727563746f723a205061737365642081527f6173736574207061697220626f756e64732061726520696e76616c69642e0000602082015260400192915050565b60006104b7604283610595565b7f5457415041756374696f6e3a204d75737420626520657175616c20616d6f756e81527f74206f6620617373657420706169722068617368657320616e6420626f756e6460208201527f732e000000000000000000000000000000000000000000000000000000000000604082015260600192915050565b602080825281016101f08161044b565b602080825281016101f0816104aa565b6040518181016001604060020a038111828210171561056d57600080fd5b604052919050565b60006001604060020a0382111561058b57600080fd5b5060209081020190565b90815260200190565b60006101f0826105b7565b90565b60006101f08261059e565b600160a060020a031690565b6102c1806105d26000396000f3fe608060405234801561001057600080fd5b506004361061009a576000357c0100000000000000000000000000000000000000000000000000000000900480635c99ee01116100785780635c99ee01146100cd5780637920c127146100d5578063aa6f6082146100dd578063fe86b9ab146100f25761009a565b80630cccfc581461009f578063115cc928146100bd5780631b93b699146100c5575b600080fd5b6100a7610113565b6040516100b491906101ca565b60405180910390f35b6100a7610119565b6100a761011f565b6100a7610124565b6100a761012a565b6100e5610130565b6040516100b491906101b6565b610105610100366004610178565b61014c565b6040516100b49291906101d8565b60005481565b60055481565b600281565b60035481565b60025481565b60015473ffffffffffffffffffffffffffffffffffffffff1681565b6004602052600090815260409020805460019091015482565b6000610171823561020c565b9392505050565b60006020828403121561018a57600080fd5b60006101968484610165565b949350505050565b6101a78161020f565b82525050565b6101a78161020c565b602081016101c4828461019e565b92915050565b602081016101c482846101ad565b604081016101e682856101ad565b61017160208301846101ad565b73ffffffffffffffffffffffffffffffffffffffff1690565b90565b60006101c48260006101c4826101f3565b80516020909101511190565b60008282018381101561017157600080fd5b60008261024d575060006101c4565b8282028284828161025a57fe5b041461017157600080fd5b600080821161027357600080fd5b600082848161027e57fe5b0494935050505056fea265627a7a723058203d287e58d3fe8ad2c8c6812009f6931c07cc9366a66c0542ff0c68143fb0ee766c6578706572696d656e74616cf50037",deployedBytecode:"0x608060405234801561001057600080fd5b506004361061009a576000357c0100000000000000000000000000000000000000000000000000000000900480635c99ee01116100785780635c99ee01146100cd5780637920c127146100d5578063aa6f6082146100dd578063fe86b9ab146100f25761009a565b80630cccfc581461009f578063115cc928146100bd5780631b93b699146100c5575b600080fd5b6100a7610113565b6040516100b491906101ca565b60405180910390f35b6100a7610119565b6100a761011f565b6100a7610124565b6100a761012a565b6100e5610130565b6040516100b491906101b6565b610105610100366004610178565b61014c565b6040516100b49291906101d8565b60005481565b60055481565b600281565b60035481565b60025481565b60015473ffffffffffffffffffffffffffffffffffffffff1681565b6004602052600090815260409020805460019091015482565b6000610171823561020c565b9392505050565b60006020828403121561018a57600080fd5b60006101968484610165565b949350505050565b6101a78161020f565b82525050565b6101a78161020c565b602081016101c4828461019e565b92915050565b602081016101c482846101ad565b604081016101e682856101ad565b61017160208301846101ad565b73ffffffffffffffffffffffffffffffffffffffff1690565b90565b60006101c48260006101c4826101f3565b80516020909101511190565b60008282018381101561017157600080fd5b60008261024d575060006101c4565b8282028284828161025a57fe5b041461017157600080fd5b600080821161027357600080fd5b600082848161027e57fe5b0494935050505056fea265627a7a723058203d287e58d3fe8ad2c8c6812009f6931c07cc9366a66c0542ff0c68143fb0ee766c6578706572696d656e74616cf50037",sourceMap:"1806:14450:56:-;;;3939:1271;8:9:-1;5:2;;;30:1;27;20:12;5:2;3939:1271:56;;;;;;;;;;;;;;;;;;;;;;;;1610:13:53;:30;;;2847:15:55;:34;;-1:-1:-1;;;;;;2847:34:55;-1:-1:-1;;;;;2847:34:55;;;;;2891:10;:24;;;2925:8;:20;;;4422:23:56;;4395;;:50;4374:163;;;;;;;;;;;;;;;;;;;;;;4553:9;4548:305;4572:16;:23;4568:1;:27;4548:305;;;4641:29;:16;4658:1;4641:19;;;;;;;;;;;;;;:27;;;;;:29;;;:::i;:::-;4616:150;;;;;;;;;;;;;;4823:16;4840:1;4823:19;;;;;;;;;;;;;;4781:18;:39;4800:16;4817:1;4800:19;;;;;;;;;;;;;;;;;;;4781:39;;;;;;;;;;;-1:-1:-1;4781:39:56;:61;;;;;;;;;;;;4597:3;4548:305;;;-1:-1:-1;5083:120:56;5176:26;:11;5192:9;5176:15;;;;;;:26;:::i;:::-;5083:75;5115:42;:11;3036:1;5115:15;;;;;;:42;:::i;:::-;5083:14;;:31;;;;;;:75;:::i;:::-;:92;;;;;;;:120;:::i;:::-;5054:26;:149;-1:-1:-1;1806:14450:56;;-1:-1:-1;;;;;1806:14450:56;845:117:174;944:11;;930;;;;;:25;;845:117::o;1439:145:166:-;1497:7;1528:5;;;1551:6;;;;1543:15;;;;;;1576:1;-1:-1:-1;1439:145:166;;;;;:::o;231:421::-;289:7;529:6;525:45;;-1:-1:-1;558:1:166;551:8;;525:45;592:5;;;596:1;592;:5;:1;615:5;;;;;:10;607:19;;;;;782:296;840:7;937:1;933;:5;925:14;;;;;;949:9;965:1;961;:5;;;;;;;782:296;-1:-1:-1;;;;782:296:166:o;23:722:-1:-;;151:3;144:4;136:6;132:17;128:27;118:2;;169:1;166;159:12;118:2;199:6;193:13;221:80;236:64;293:6;236:64;;;221:80;;;212:89;;318:5;343:6;336:5;329:21;373:4;365:6;361:17;351:27;;395:4;390:3;386:14;379:21;;448:6;495:3;487:4;479:6;475:17;470:3;466:27;463:36;460:2;;;512:1;509;502:12;460:2;537:1;522:217;547:6;544:1;541:13;522:217;;;605:3;627:48;671:3;659:10;627:48;;;615:61;;-1:-1;699:4;690:14;;;;718;;;;;569:1;562:9;522:217;;;526:14;111:634;;;;;;;;791:785;;940:3;933:4;925:6;921:17;917:27;907:2;;958:1;955;948:12;907:2;988:6;982:13;1010:101;1025:85;1103:6;1025:85;;1010:101;1001:110;;1128:5;1153:6;1146:5;1139:21;1183:4;1175:6;1171:17;1161:27;;1205:4;1200:3;1196:14;1189:21;;1258:6;1305:3;1297:4;1289:6;1285:17;1280:3;1276:27;1273:36;1270:2;;;1322:1;1319;1312:12;1270:2;1347:1;1332:238;1357:6;1354:1;1351:13;1332:238;;;1415:3;1437:69;1502:3;1490:10;1437:69;;;1425:82;;-1:-1;1530:4;1521:14;;;;1558:4;1549:14;;;;;1379:1;1372:9;1332:238;;1584:122;;1662:39;1693:6;1687:13;1662:39;;;1653:48;1647:59;-1:-1;;;1647:59;1713:172;;1816:64;1872:6;1866:13;1816:64;;1926:493;;2047:4;2035:9;2030:3;2026:19;2022:30;2019:2;;;2065:1;2062;2055:12;2019:2;2083:20;2098:4;2083:20;;;2074:29;-1:-1;2152:1;2183:60;2239:3;2219:9;2183:60;;;2159:85;;-1:-1;2304:2;2337:60;2393:3;2369:22;;;2337:60;;;2330:4;2323:5;2319:16;2312:86;2265:144;2013:406;;;;;2555:1296;;;;;;;2851:3;2839:9;2830:7;2826:23;2822:33;2819:2;;;2868:1;2865;2858:12;2819:2;2903:1;2920:89;3001:7;2981:9;2920:89;;;2910:99;;2882:133;3046:2;3064:64;3120:7;3111:6;3100:9;3096:22;3064:64;;;3054:74;;3025:109;3165:2;3183:64;3239:7;3230:6;3219:9;3215:22;3183:64;;;3173:74;;3144:109;3284:2;3302:64;3358:7;3349:6;3338:9;3334:22;3302:64;;;3292:74;;3263:109;3424:3;3413:9;3409:19;3403:26;-1:-1;;;;;3441:6;3438:30;3435:2;;;3481:1;3478;3471:12;3435:2;3501:89;3582:7;3573:6;3562:9;3558:22;3501:89;;;3491:99;;3382:214;3648:3;3637:9;3633:19;3627:26;-1:-1;;;;;3665:6;3662:30;3659:2;;;3705:1;3702;3695:12;3659:2;3725:110;3827:7;3818:6;3807:9;3803:22;3725:110;;;3715:120;;3606:235;2813:1038;;;;;;;;;3859:465;;4019:67;4083:2;4078:3;4019:67;;;4119:66;4099:87;;4220:66;4215:2;4206:12;;4199:88;4315:2;4306:12;;4005:319;-1:-1;;4005:319;4333:566;;4493:67;4557:2;4552:3;4493:67;;;4593:66;4573:87;;4694:66;4689:2;4680:12;;4673:88;4795:66;4790:2;4781:12;;4774:88;4890:2;4881:12;;4479:420;-1:-1;;4479:420;4907:407;5098:2;5112:47;;;5083:18;;5173:131;5083:18;5173:131;;5321:407;5512:2;5526:47;;;5497:18;;5587:131;5497:18;5587:131;;5735:256;5797:2;5791:9;5823:17;;;-1:-1;;;;;5883:34;;5919:22;;;5880:62;5877:2;;;5955:1;5952;5945:12;5877:2;5971;5964:22;5775:216;;-1:-1;5775:216;5998:258;;-1:-1;;;;;6149:6;6146:30;6143:2;;;6189:1;6186;6179:12;6143:2;-1:-1;6218:4;6206:17;;;6236:15;;6080:176;6550:163;6653:19;;;6702:4;6693:14;;6646:67;6721:105;;6790:31;6815:5;6790:31;;6833:79;6902:5;6885:27;6919:130;;7013:31;7038:5;7013:31;;7056:128;-1:-1;;;;;7125:54;;7108:76;;1806:14450:56;;;;;;",deployedSourceMap:"1806:14450:56:-;;;;8:9:-1;5:2;;;30:1;27;20:12;5:2;1806:14450:56;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;1352:28:53;;;:::i;:::-;;;;;;;;;;;;;;;;3316:41:56;;;:::i;2984:53::-;;;:::i;2252:23:55:-;;;:::i;2171:25::-;;;:::i;2126:39::-;;;:::i;:::-;;;;;;;;3191:66:56;;;;;;;;;:::i;:::-;;;;;;;;;1352:28:53;;;;:::o;3316:41:56:-;;;;:::o;2984:53::-;3036:1;2984:53;:::o;2252:23:55:-;;;;:::o;2171:25::-;;;;:::o;2126:39::-;;;;;;:::o;3191:66:56:-;;;;;;;;;;;;;;;;;;;:::o;5:118:-1:-;;72:46;110:6;97:20;72:46;;;63:55;57:66;-1:-1;;;57:66;130:241;;234:2;222:9;213:7;209:23;205:32;202:2;;;250:1;247;240:12;202:2;285:1;302:53;347:7;327:9;302:53;;;292:63;196:175;-1:-1;;;;196:175;378:176;486:62;542:5;486:62;;;481:3;474:75;468:86;;;561:120;644:31;669:5;644:31;;688:263;831:2;816:18;;845:96;820:9;914:6;845:96;;;802:149;;;;;958:213;1076:2;1061:18;;1090:71;1065:9;1134:6;1090:71;;1178:324;1324:2;1309:18;;1338:71;1313:9;1382:6;1338:71;;;1420:72;1488:2;1477:9;1473:18;1464:6;1420:72;;1509:128;1589:42;1578:54;;1561:76;1644:79;1713:5;1696:27;1816:171;;1920:62;1976:5;1994:140;2098:31;2123:5;2098:31;;2079:55;944:11:174;;930;;;;;:25;;845:117::o;1439:145:166:-;1497:7;1528:5;;;1551:6;;;;1543:15;;;;;231:421;289:7;529:6;525:45;;-1:-1:-1;558:1:166;551:8;;525:45;592:5;;;596:1;592;:5;:1;615:5;;;;;:10;607:19;;;;;782:296;840:7;937:1;933;:5;925:14;;;;;;949:9;965:1;961;:5;;;;;;;782:296;-1:-1:-1;;;;782:296:166:o",source:'/*\n    Copyright 2020 Set Labs Inc.\n\n    Licensed under the Apache License, Version 2.0 (the "License");\n    you may not use this file except in compliance with the License.\n    You may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\n    Unless required by applicable law or agreed to in writing, software\n    distributed under the License is distributed on an "AS IS" BASIS,\n    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n    See the License for the specific language governing permissions and\n    limitations under the License.\n*/\n\npragma solidity 0.5.7;\npragma experimental "ABIEncoderV2";\n\nimport { Math } from "openzeppelin-solidity/contracts/math/Math.sol";\nimport { SafeMath } from "openzeppelin-solidity/contracts/math/SafeMath.sol";\nimport { AddressArrayUtils } from "set-protocol-contract-utils/contracts/lib/AddressArrayUtils.sol";\nimport { BoundsLibrary } from "set-protocol-contract-utils/contracts/lib/BoundsLibrary.sol";\nimport { CommonMath } from "set-protocol-contract-utils/contracts/lib/CommonMath.sol";\n\nimport { Auction } from "../impl/Auction.sol";\nimport { LinearAuction } from "../impl/LinearAuction.sol";\nimport { LiquidatorUtils } from "../utils/LiquidatorUtils.sol";\nimport { IOracleWhiteList } from "../../../core/interfaces/IOracleWhiteList.sol";\nimport { ISetToken } from "../../../core/interfaces/ISetToken.sol";\nimport { IRebalancingSetTokenV3 } from "../../../core/interfaces/IRebalancingSetTokenV3.sol";\nimport { TwoAssetPriceBoundedLinearAuction } from "../impl/TwoAssetPriceBoundedLinearAuction.sol";\n\n\n/**\n * @title TWAPAuction\n * @author Set Protocol\n *\n * Contract for executing TWAP Auctions fropm initializing to moving to the next chunk auction. Inherits from\n * TwoAssetPriceBoundedLinearAuction\n */\ncontract TWAPAuction is TwoAssetPriceBoundedLinearAuction {\n    using SafeMath for uint256;\n    using CommonMath for uint256;\n    using AddressArrayUtils for address[];\n    using BoundsLibrary for BoundsLibrary.Bounds;\n\n    /* ============ Structs ============ */\n\n    struct TWAPState {\n        LinearAuction.State chunkAuction;   // Current chunk auction state\n        uint256 orderSize;                  // Beginning amount of currentSets\n        uint256 orderRemaining;             // Amount of current Sets not auctioned or being auctioned\n        uint256 lastChunkAuctionEnd;        // Time of last chunk auction end\n        uint256 chunkAuctionPeriod;         // Time between chunk auctions\n        uint256 chunkSize;                  // Amount of current Sets in a full chunk auction\n    }\n\n    struct TWAPLiquidatorData {\n        uint256 chunkSizeValue;             // Currency value of rebalance volume in each chunk (18 decimal)\n        uint256 chunkAuctionPeriod;         // Time between chunk auctions\n    }\n\n    /* ============ Constants ============ */\n\n    // Auction completion buffer assumes completion potentially 2% after fair value when auction started\n    uint256 constant public AUCTION_COMPLETION_BUFFER = 2;\n\n    /* ============ State Variables ============ */\n\n    // Mapping between an address pair\'s unique keccak256 hash and the min/max USD-chunk size\n    mapping(bytes32 => BoundsLibrary.Bounds) public chunkSizeWhiteList;\n    //Estimated length in seconds of a chunk auction\n    uint256 public expectedChunkAuctionLength;\n\n    /* ============ Constructor ============ */\n\n    /**\n     * TWAPAuction constructor\n     *\n     * @param _oracleWhiteList        OracleWhiteList used by liquidator\n     * @param _auctionPeriod          Length of auction in seconds\n     * @param _rangeStart             Percentage below FairValue to begin auction at\n     * @param _rangeEnd               Percentage above FairValue to end auction at\n     * @param _assetPairHashes        List of identifying hashes of asset pairs\n     * @param _assetPairBounds        List of chunk size bounds for each asset pair\n     */\n    constructor(\n        IOracleWhiteList _oracleWhiteList,\n        uint256 _auctionPeriod,\n        uint256 _rangeStart,\n        uint256 _rangeEnd,\n        bytes32[] memory _assetPairHashes,\n        BoundsLibrary.Bounds[] memory _assetPairBounds\n    )\n        public\n        TwoAssetPriceBoundedLinearAuction(\n            _oracleWhiteList,\n            _auctionPeriod,\n            _rangeStart,\n            _rangeEnd\n        )\n    {\n        require(\n            _assetPairHashes.length == _assetPairBounds.length,\n            "TWAPAuction: Must be equal amount of asset pair hashes and bounds."\n        );\n\n        for (uint256 i = 0; i < _assetPairHashes.length; i++) {\n            require(\n                _assetPairBounds[i].isValid(),\n                "TWAPAuction.constructor: Passed asset pair bounds are invalid."\n            );\n\n            chunkSizeWhiteList[_assetPairHashes[i]] = _assetPairBounds[i];\n        }\n\n        // Expected length of a chunk auction, assuming the auction goes 2% beyond initial fair\n        // value. Used to validate TWAP Auction length won\'t exceed Set\'s rebalanceFailPeriod.\n        expectedChunkAuctionLength = _auctionPeriod\n            .mul(_rangeStart.add(AUCTION_COMPLETION_BUFFER))\n            .div(_rangeStart.add(_rangeEnd));\n    }\n\n    /* ============ Internal Functions ============ */\n\n    /**\n     * Populates the TWAPState struct and initiates first chunk auction.\n     *\n     * @param _twapAuction                  TWAPAuction State object\n     * @param _currentSet                   The Set to rebalance from\n     * @param _nextSet                      The Set to rebalance to\n     * @param _startingCurrentSetQuantity   Quantity of currentSet to rebalance\n     * @param _liquidatorData               Struct of parsed liquidator data\n     */\n    function initializeTWAPAuction(\n        TWAPState storage _twapAuction,\n        ISetToken _currentSet,\n        ISetToken _nextSet,\n        uint256 _startingCurrentSetQuantity,\n        TWAPLiquidatorData memory _liquidatorData\n    )\n        internal\n    {\n        // Calculate currency value of rebalance volume\n        uint256 rebalanceVolume = LiquidatorUtils.calculateRebalanceVolume(\n            _currentSet,\n            _nextSet,\n            oracleWhiteList,\n            _startingCurrentSetQuantity\n        );\n\n        // Calculate the size of each chunk auction in currentSet terms\n        uint256 chunkSize = calculateChunkSize(\n            _startingCurrentSetQuantity,\n            rebalanceVolume,\n            _liquidatorData.chunkSizeValue\n        );\n\n        // Initialize first chunk auction\n        LinearAuction.initializeLinearAuction(\n            _twapAuction.chunkAuction,\n            _currentSet,\n            _nextSet,\n            chunkSize\n        );\n\n        // Set TWAPState\n        _twapAuction.orderSize = _startingCurrentSetQuantity;\n        _twapAuction.orderRemaining = _startingCurrentSetQuantity.sub(chunkSize);\n        _twapAuction.chunkSize = chunkSize;\n        _twapAuction.lastChunkAuctionEnd = block.timestamp.sub(_liquidatorData.chunkAuctionPeriod);\n        _twapAuction.chunkAuctionPeriod = _liquidatorData.chunkAuctionPeriod;\n    }\n\n    /**\n     * Resets state for next chunk auction (except minimumBid and token flow arrays), and updates\n     * orderRemaining value for TWAP auction.\n     *\n     * @param _twapAuction                  TWAPAuction State object\n     */\n    function auctionNextChunk(\n        TWAPState storage _twapAuction\n    )\n        internal\n    {\n        // Add leftover current Sets from previous chunk auction to orderRemaining\n        uint256 totalRemainingSets = _twapAuction.orderRemaining.add(\n            _twapAuction.chunkAuction.auction.remainingCurrentSets\n        );\n\n        // Calculate next chunk auction size as min of chunkSize or orderRemaining\n        uint256 nextChunkAuctionSize = Math.min(_twapAuction.chunkSize, totalRemainingSets);\n\n        // Start new chunk auction by over writing previous auction state and decrementing orderRemaining\n        overwriteChunkAuctionState(_twapAuction, nextChunkAuctionSize);\n        _twapAuction.orderRemaining = totalRemainingSets.sub(nextChunkAuctionSize);\n    }\n\n    /* ============ Internal Helper Functions ============ */\n\n    /**\n     * Resets state for next chunk auction (except minimumBid and token flow arrays)\n     *\n     * @param _twapAuction                  TWAPAuction State object\n     * @param _chunkAuctionSize             Size of next chunk auction\n     */\n    function overwriteChunkAuctionState(\n        TWAPState storage _twapAuction,\n        uint256 _chunkAuctionSize\n    )\n        internal\n    {\n        _twapAuction.chunkAuction.auction.startingCurrentSets = _chunkAuctionSize;\n        _twapAuction.chunkAuction.auction.remainingCurrentSets = _chunkAuctionSize;\n        _twapAuction.chunkAuction.auction.startTime = block.timestamp;\n        _twapAuction.chunkAuction.endTime = block.timestamp.add(auctionPeriod);\n\n        // Since currentSet and nextSet param is not used in calculating start and end price on\n        // TwoAssetPriceBoundedLinearAuction we can pass in zero addresses\n        _twapAuction.chunkAuction.startPrice = calculateStartPrice(\n            _twapAuction.chunkAuction.auction,\n            ISetToken(address(0)),\n            ISetToken(address(0))\n        );\n        _twapAuction.chunkAuction.endPrice = calculateEndPrice(\n            _twapAuction.chunkAuction.auction,\n            ISetToken(address(0)),\n            ISetToken(address(0))\n        );\n    }\n\n    /**\n     * Validates that chunk size is within asset bounds and passed chunkAuctionLength\n     * is unlikely to push TWAPAuction beyond rebalanceFailPeriod.\n     *\n     * @param _currentSet                   The Set to rebalance from\n     * @param _nextSet                      The Set to rebalance to\n     * @param _startingCurrentSetQuantity   Quantity of currentSet to rebalance\n     * @param _liquidatorData               Struct of parsed liquidator data\n     */\n    function validateLiquidatorData(\n        ISetToken _currentSet,\n        ISetToken _nextSet,\n        uint256 _startingCurrentSetQuantity,\n        TWAPLiquidatorData memory _liquidatorData\n    )\n        internal\n        view\n    {\n        // Calculate currency value of rebalance volume\n        uint256 rebalanceVolume = LiquidatorUtils.calculateRebalanceVolume(\n            _currentSet,\n            _nextSet,\n            oracleWhiteList,\n            _startingCurrentSetQuantity\n        );\n\n        bytes32 assetPairHash = getAssetPairHashFromCollateral(_currentSet, _nextSet);\n\n        validateTWAPParameters(\n            _liquidatorData,\n            assetPairHash,\n            rebalanceVolume\n        );\n    }\n\n    /**\n     * Validates passed in parameters for TWAP auction\n     *\n     * @param _twapLiquidatorData       Struct of passed liquidator data\n     * @param _assetPairHash            Hash of asset pair being rebalanceds\n     * @param _rebalanceVolume          Value of collateral being rebalanced\n     */\n    function validateTWAPParameters(\n        TWAPLiquidatorData memory _twapLiquidatorData,\n        bytes32 _assetPairHash,\n        uint256 _rebalanceVolume\n    )\n        internal\n        view\n    {\n        // Bounds and chunkSizeValue denominated in currency value\n        require(\n            chunkSizeWhiteList[_assetPairHash].isWithin(_twapLiquidatorData.chunkSizeValue),\n            "TWAPAuction.validateTWAPParameters: Passed chunk size must be between bounds."\n        );\n\n        // Want to make sure that the expected length of the auction is less than the rebalanceFailPeriod\n        // or else a legitimate auction could be failed. Calculated as such:\n        // expectedTWAPTime = numChunkAuctions * expectedChunkAuctionLength + (numChunkAuctions - 1) *\n        // chunkAuctionPeriod\n        uint256 numChunkAuctions = _rebalanceVolume.divCeil(_twapLiquidatorData.chunkSizeValue);\n        uint256 expectedTWAPAuctionTime = numChunkAuctions.mul(expectedChunkAuctionLength)\n            .add(numChunkAuctions.sub(1).mul(_twapLiquidatorData.chunkAuctionPeriod));\n\n        uint256 rebalanceFailPeriod = IRebalancingSetTokenV3(msg.sender).rebalanceFailPeriod();\n\n        require(\n            expectedTWAPAuctionTime < rebalanceFailPeriod,\n            "TWAPAuction.validateTWAPParameters: Expected auction duration exceeds allowed length."\n        );\n    }\n\n    /**\n     * The next chunk auction can begin when the previous auction has completed, there are still currentSets to\n     * rebalance, and the auction period has elapsed.\n     *\n     * @param _twapAuction                  TWAPAuction State object\n     */\n    function validateNextChunkAuction(\n        TWAPState storage _twapAuction\n    )\n        internal\n        view\n    {\n        Auction.validateAuctionCompletion(_twapAuction.chunkAuction.auction);\n\n        require(\n            isRebalanceActive(_twapAuction),\n            "TWAPState.validateNextChunkAuction: TWAPAuction is finished."\n        );\n\n        require(\n            _twapAuction.lastChunkAuctionEnd.add(_twapAuction.chunkAuctionPeriod) <= block.timestamp,\n            "TWAPState.validateNextChunkAuction: Not enough time elapsed from last chunk auction end."\n        );\n    }\n\n    /**\n     * Checks if the amount of Sets still to be auctioned (in aggregate) is greater than the minimumBid\n     *\n     * @param _twapAuction                  TWAPAuction State object\n     */\n    function isRebalanceActive(\n        TWAPState storage _twapAuction\n    )\n        internal\n        view\n        returns (bool)\n    {\n        // Sum of remaining Sets in current chunk auction and order remaining\n        uint256 totalRemainingSets = _twapAuction.orderRemaining.add(\n            _twapAuction.chunkAuction.auction.remainingCurrentSets\n        );\n        \n        // Check that total remaining sets is greater than minimumBid\n        return totalRemainingSets > _twapAuction.chunkAuction.auction.minimumBid;\n    }\n\n    /**\n     * Calculates chunkSize of auction in current Set terms\n     *\n     * @param _totalSetAmount       Total amount of Sets being auctioned\n     * @param _rebalanceVolume      The total currency value being auctioned\n     * @param _chunkSizeValue       Value of chunk size in currency terms\n     */\n    function calculateChunkSize(\n        uint256 _totalSetAmount,\n        uint256 _rebalanceVolume,\n        uint256 _chunkSizeValue\n    )\n        internal\n        view\n        returns (uint256)\n    {\n        // Since solidity rounds down anything equal to 1 will require at least one auction\n        // equal to the chunkSizeValue\n        if (_rebalanceVolume.div(_chunkSizeValue) >= 1) {\n            return _totalSetAmount.mul(_chunkSizeValue).div(_rebalanceVolume);\n        } else {\n            return _totalSetAmount;\n        }\n    }\n\n    /**\n     * Get asset pair hash from passed collateral.\n     *\n     * @param _currentSet                   The Set to rebalance from\n     * @param _nextSet                      The Set to rebalance to\n     */\n    function getAssetPairHashFromCollateral(\n        ISetToken _currentSet,\n        ISetToken _nextSet\n    )\n        internal\n        view\n        returns (bytes32)\n    {\n        // Get set components\n        address[] memory currentSetComponents = _currentSet.getComponents();\n        address[] memory nextSetComponents = _nextSet.getComponents();\n\n        address[] memory assetPairComponents = currentSetComponents.union(nextSetComponents);\n\n        return getAssetPairHash(assetPairComponents[0], assetPairComponents[1]);\n    }\n\n    /**\n     * Returns hash of token pair where token address with lowest numerical value is hashed first.\n     *\n     * @param _assetOne                   First asset in pair\n     * @param _assetTwo                   Second asset in pair\n     */\n    function getAssetPairHash(\n        address _assetOne,\n        address _assetTwo\n    )\n        internal\n        pure\n        returns (bytes32)\n    {\n        return _assetOne < _assetTwo ? keccak256(abi.encodePacked(_assetOne, _assetTwo)) :\n            keccak256(abi.encodePacked(_assetTwo, _assetOne));\n    }\n\n    function parseLiquidatorData(\n        bytes memory _liquidatorData\n    )\n        internal\n        pure\n        returns (TWAPLiquidatorData memory)\n    {\n        return abi.decode(_liquidatorData, (TWAPLiquidatorData));\n    }\n}',
sourcePath:"/Users/brianweickmann/Documents/Source/set-protocol-contracts/contracts/core/liquidators/twap-impl/TWAPAuction.sol",compiler:{name:"solc",version:"0.5.7+commit.6da8b019.Linux.g++"},networks:{},schemaVersion:"3.0.23",updatedAt:"2020-05-05T17:13:36.536Z",devdoc:{author:"Set Protocol * Contract for executing TWAP Auctions fropm initializing to moving to the next chunk auction. Inherits from TwoAssetPriceBoundedLinearAuction",methods:{constructor:{params:{_assetPairBounds:"List of chunk size bounds for each asset pair",_assetPairHashes:"List of identifying hashes of asset pairs",_auctionPeriod:"Length of auction in seconds",_oracleWhiteList:"OracleWhiteList used by liquidator",_rangeEnd:"Percentage above FairValue to end auction at",_rangeStart:"Percentage below FairValue to begin auction at"}}},title:"TWAPAuction"},userdoc:{methods:{constructor:"TWAPAuction constructor"}}};